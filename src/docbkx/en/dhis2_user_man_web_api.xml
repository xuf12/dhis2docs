<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" []>
<chapter>
  <title>Web API</title>
  <para>The Web API is a component which makes it possible for external systems  to access and manipulate  data stored in an instance of DHIS 2. More precisely, it provides a   programmatic interface to a wide range of exposed data and service methods for applications such as third-party software clients, web portals and  internal DHIS 2 modules.</para>
  <section>
    <title>Introduction</title>
    <para>The Web API adheres to many of the principles behind the REST architectural style. To mention some few and important ones:</para>
    <orderedlist>
      <listitem>
        <para>The fundamental building blocks are referred to as <emphasis role="italic">resources</emphasis>. A resource can be anything exposed to the Web, from a document to a business process - anything a client might want to interact with. The information aspects of a resource can be retrieved or exchanged through resource <emphasis role="italic">representations</emphasis>. A representation is a view of a resource&apos;s state at any given time. For instance, the <emphasis role="italic">reportTable</emphasis> resource in DHIS represents a tabular report of aggregated data for a certain set of parameters. This resource can be retrieved in a variety of representation formats including HTML, PDF, and MS Excel.</para>
      </listitem>
      <listitem>
        <para>All resources can be uniquely identified by a <emphasis role="italic">URI</emphasis> (also referred to as <emphasis role="italic">URL</emphasis>). All resources have a default representation. You can indicate that you are interested in a specific representation  by supplying an <emphasis role="italic">Accept</emphasis> HTTP header, a file extension or a <emphasis role="italic">format</emphasis> query parameter. So in order to retrieve the PDF representation of a report table you can  supply a <emphasis role="italic">Accept: application/pdf</emphasis> header or append <emphasis role="italic">.pdf</emphasis> or <emphasis role="italic">?format=pdf</emphasis> to your request URL.</para>
      </listitem>
      <listitem>
        <para>Interactions with the API requires correct use of HTTP <emphasis role="italic">methods</emphasis> or <emphasis role="italic">verbs</emphasis>. This implies that for a resource you must issue a  <emphasis role="italic">GET</emphasis> request when you want to retrieve it, <emphasis role="italic">POST</emphasis> request when you want to create one, <emphasis role="italic">PUT</emphasis> when you want to update it and <emphasis role="italic">DELETE</emphasis> when you want to remove it. So if you want to retrieve the default representation of a report table you can send a GET request to e.g. <emphasis role="italic">/reportTable/iu8j/hYgF6t</emphasis>, where the last part is the report table identifier.</para>
      </listitem>
      <listitem>
        <para>Resource representations are <emphasis role="italic">linkable</emphasis>, meaning that representations advertise other resources which are relevant to the current one by embedding links into itself. This feature greatly improves the usability and robustness of the API as we will see later. For instance, you can easily navigate to the indicators which are associated with a report table from the <emphasis role="italic">reportTable</emphasis> resource  through the embedded links using your preferred representation format.</para>
      </listitem>
    </orderedlist>
    <para>While all of this might sound complicated, the Web API is actually very simple to use. We will proceed with a few practical examples in a minute.</para>
  </section>
  <section>
    <title>Authentication</title>
    <para>In order to interoperate with the Web API you will have to authenticate using <emphasis role="italic">Basic authentication</emphasis>. Basic authentication is a technique for clients to send login credentials over HTTP to a web server. Technically speaking, the username is appended with a colon and the password, Base64-encoded, prefixed Basic  and   supplied as the value of the <emphasis role="italic">Authorization</emphasis> HTTP header. More formally that is<code> Authorization: Basic base64encode(username:password)</code> An important note is that this authentication scheme provides no security since the username and password is sent in plain text and can be easily decoded. Using it is  recommended only if the server is using SSL/TLS (HTTPS) to encrypt communication between itself and the client. Most DHIS 2 deployments typically use SSL today - consider it a hard requirement to provide secure interactions with the Web API.</para>
    <para>If you are building a form-based web application and want to authenticate using a web form
      you can have the form send a POST request to the login endpoint in DHIS which is <emphasis
        role="italic">/dhis-web-commons-security/login.action</emphasis> . Two request parameters,
        <emphasis role="italic">j_username</emphasis> and <emphasis role="italic"
        >j_password</emphasis>, containing the username and password in clear-text respectively, are
      expected. The browser will then receive a cookie which will be used for authentication for
      subsequent requests.</para>
    <para>You can verify and get information about the currently autenticated user by making a GET
      request to the following URL:</para>
    <screen>/api/currentUser</screen>
  </section>
  <section>
    <title>Date and period format</title>
    <para>Throughout the Web API we refer to dates and periods. The date format  is:</para>
    <screen>yyyy-MM-dd</screen>
    <para>For instance, if you want to express March 20, 2012 you must use <emphasis role="italic">2012-03-20</emphasis>.</para>
    <para>The period format is described in the following table. </para>
    <table>
      <title>Period format</title>
      <tgroup cols="4">
        <thead>
          <row>
            <entry>
              <emphasis role="italic">Interval</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Format</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Example</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Description</emphasis>
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>Day</entry>
            <entry>yyyyMMdd</entry>
            <entry>20040315</entry>
            <entry>March 15 2004</entry>
          </row>
          <row>
            <entry>Week</entry>
            <entry>yyyyWn</entry>
            <entry>2004W10</entry>
            <entry>Week 10 2004</entry>
          </row>
          <row>
            <entry>Month</entry>
            <entry>yyyyMM</entry>
            <entry>200403</entry>
            <entry>March 2004</entry>
          </row>
          <row>
            <entry>Quarter</entry>
            <entry>yyyyQn</entry>
            <entry>2004Q1</entry>
            <entry>January-March 2004</entry>
          </row>
          <row>
            <entry>Six-month</entry>
            <entry>yyyySn</entry>
            <entry>2004S1</entry>
            <entry>Janary-June 2004</entry>
          </row>
          <row>
            <entry>Year</entry>
            <entry>yyyy</entry>
            <entry>2004</entry>
            <entry>2004</entry>
          </row>
          <row>
            <entry>Financial Year April</entry>
            <entry>yyyyApril</entry>
            <entry>2004April</entry>
            <entry>Apr 2004-Mar 2005</entry>
          </row>
          <row>
            <entry>Financial Year July</entry>
            <entry>yyyyJuly</entry>
            <entry>2004July</entry>
            <entry>July 2004-June 2005</entry>
          </row>
          <row>
            <entry>Financial Year Oct</entry>
            <entry>yyyyOct</entry>
            <entry>2004Oct</entry>
            <entry>Oct 2004-Sep 2005</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>In some parts of the API, like for the analytics resource, you can utilize relative
      periods in addition to fixed periods (defined above). The relative periods are relative to the
      current date, and allows e.g. for creating dynamic reports. The available relative period
      values are:</para>
    <screen>LAST_MONTH, LAST_BIMONTH, LAST_QUARTER, LAST_SIX_MONTH, MONTHS_THIS_YEAR, QUARTERS_THIS_YEAR, 
THIS_YEAR, MONTHS_LAST_YEAR, QUARTERS_LAST_YEAR, LAST_YEAR, LAST_5_YEARS, LAST_12_MONTHS, 
LAST_3_MONTHS, LAST_6_BIMONTHS, LAST_4_QUARTERS, LAST_2_SIXMONTHS, THIS_FINANCIAL_YEAR, 
LAST_FINANCIAL_YEAR, LAST_5_FINANCIAL_YEARS, LAST_WEEK, LAST_4_WEEKS, LAST_12_WEEKS, LAST_52_WEEKS</screen>
  </section>
  <section>
    <title>Browsing the Web API</title>
    <para>The entry point for browsing the Web API is <emphasis role="italic"
        >/api/resources</emphasis>. This resource provide links to all available resources. Four
      resouce representation formats are consistently available for all resources: HTML, XML, JSON
      and JSONP. Some resources will have other formats available, like MS Excel, PDF, CSV and PNG.
      To explore the API from a web browser, navigate to the <emphasis role="italic"
        >/api/resources</emphasis> entry point and follow the links to your desired resource, for
      instance <emphasis role="italic">/api/resources/dataElements</emphasis>. For all resources
      which return a list of elements certain query parameters can be used to modify the
      response:</para>
    <para>
      <table frame="all">
        <title>Query parameters</title>
        <tgroup cols="4">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Param</entry>
              <entry>Option values</entry>
              <entry>Default option</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>viewClass</entry>
              <entry>basic | export | detailed </entry>
              <entry>basic</entry>
              <entry>Defines how much information to display for each element.</entry>
            </row>
            <row>
              <entry>links</entry>
              <entry>true | false</entry>
              <entry>true</entry>
              <entry>Indicates whether to include links to relevant elements.</entry>
            </row>
            <row>
              <entry>paging</entry>
              <entry>true | false</entry>
              <entry>true</entry>
              <entry>Indicates whether to return lists of elements in pages.</entry>
            </row>
            <row>
              <entry>page</entry>
              <entry>number</entry>
              <entry>1</entry>
              <entry>Defines which page number to return.</entry>
            </row>
            <row>
              <entry>pageSize</entry>
              <entry>number</entry>
              <entry>50</entry>
              <entry>Defines the number of elements to return for each page.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </para>
    <para>An example of how these parameters can be used to get a full list of data element groups
      in XML response format is:</para>
    <screen>/api/dataElementGroups.xml?viewClass=detailed&amp;links=false&amp;paging=false</screen>
    <para>You can query for elements on the name property instead of returning full list of elements
      using the <emphasis role="italic">query</emphasis> path variable. In this example we query for
      all data elements with the word "anaemia" in the name:</para>
    <screen>/api/dataElements/query/anaemia</screen>
    <para>You can search for elements through the id, name and code property using the <emphasis
        role="italic">search</emphasis> path variable. In this example we search for a data element
      with the word "DE_34" as id, name or
      code:<screen>/api/dataElements/search/DE_34</screen></para>
  </section>
  <section>
    <title>Working with the meta-data API</title>
    <para>The meta-data resource can be accessed at <emphasis role="italic"
      >/api/metaData</emphasis>. This resource lets you read and write the full set of meta-data.
      This section will give a basic introduction to working with this API. For specific
      synchronization issues, please see the integration chapter.</para>
    <para>By default, interacting with<emphasis role="italic"> /api/metaData</emphasis> using the
      GET HTTP method will give you all meta-data rendered as XML. You can also be more specific
      about the meta-data elements you are interested in.</para>
    <para>
      <table>
        <title>Available Content-Types</title>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>
                <emphasis role="italic">Content-Type</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Description</emphasis>
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>application/xml</entry>
              <entry>Returns the meta-data in XML representation</entry>
            </row>
            <row>
              <entry>application/json</entry>
              <entry>Returns the meta-data in JSON representation</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </para>
    <para>
    <table>
        <title>Available Query Filters</title>
        <tgroup cols="5">
          <thead>
            <row>
              <entry>
                <emphasis role="italic">Param</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Type</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Required</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Options (default first)</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Description</emphasis>
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>assumeTrue</entry>
              <entry>boolean</entry>
              <entry>false</entry>
              <entry>true/false</entry>
              <entry>If you don&apos;t want everything that <emphasis role="italic"
                  >/api/metaData</emphasis> gives you by default, when set to false, this option
                will not return anything by default. You have to enable the resources you want
                yourself (see below). </entry>
            </row>
            <row>
              <entry>{resources}</entry>
              <entry>boolean</entry>
              <entry>false</entry>
              <entry>true/false (default depends on assumeTrue)</entry>
              <entry>Please see <emphasis role="italic">/api</emphasis> for available resources.
                This option will allow you to override the default (which is taken from assumeTrue)
                and further refine what meta-data you want. </entry>
            </row>
            <row>
              <entry>lastUpdated</entry>
              <entry>date</entry>
              <entry>false</entry>
              <entry>Three date formats are supported: YEAR | MONTH/YEAR | DAY/MONTH/YEAR</entry>
              <entry>Filters the meta-data based on the lastUpdated field, this allows you to synchronize meta-data as a nightly job, without downloading everything from the server. </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
   </para>
    <para>
      <emphasis role="bold">Example: Get a filtered set of meta-data that was updated since August 1
        2012</emphasis>
    </para>
    <para>As described in the last section, there is a number of options you can apply to <emphasis role="bold">/api/metaData</emphasis> to give you a filtered view. The use-case we will be
      looking into here, is the case where you want a nightly job that synchronizes organisation
      units. We will be using <emphasis role="italic">cURL</emphasis> as the HTTP
      client.<screen>curl -H &quot;Accept: application/xml&quot; -u user:pass
    {HOST}/api/metaData?assumeTrue=false&amp;organisationUnits=true&amp;lastUpdated=01/08/2012</screen></para>
    <para><emphasis role="bold">Example: Get meta-data that was updated since February
        2012</emphasis></para>
    <para>This example will just the default <emphasis role="italic">assumeTrue</emphasis> setting,
      along with getting the last updates from February 2012. This means that every single type that
      has been updated will be
      retrieved.<screen>curl -H &quot;Accept: application/xml&quot; -u user:pass {HOST}/api/metaData?lastUpdated=02/2012</screen></para>
    <para>The meta-data resource can also be used to write or update meta-data by using the POST
      HTTP method. The meta-data content can be both XML and JSON, using "application/xml" and
      "application/json" content type respectively. The request payload content will be accepted in
      several formats, including plain text, zipped and gzipped. POSTing a meta-data payload can be
      done for example like this, where metaData.xml is a file in the same directory with the
      meta-data content:</para>
    <screen>curl -H "Content-Type: application/xml" -u user:pass -d @metaData.xml {HOST}/api/metaData -X POST</screen>
  </section>
  <section>
    <title>Sending data values</title>
    <para>A common use-case for system integration is the need to send a set of data values from a third-party system into DHIS. In this example we will use the DHIS 2 demo on <ulink url="http://apps.dhis2.org/demo"/> as basis and we recommend that you follow the provided links with a web browser while reading (log in with <emphasis role="italic">admin</emphasis><emphasis role="italic">/district</emphasis> as username/password). We assume that we have collected case-based data using a simple software client running on mobile phones for the  <emphasis role="italic">Mortality &lt;5 years</emphasis> data set in the community of <emphasis role="italic">Ngelehun CHC</emphasis> (in <emphasis role="italic">Badjia</emphasis> chiedom, <emphasis role="italic">Bo</emphasis> district) for the month of January 2012. We have now aggregated our data into a statistical report and want to send that data to the national DHIS 2 instance.</para>
    <para>The entry point for the Web API running on the demo instance is <ulink url="http://apps.dhis2.org/demo/api"/>. The entry point provides a convenient HTML page with links to all of the available resources in the Web API. The resource which is most appropriate for our purpose of sending data values is the <emphasis role="italic">dataValueSets</emphasis> resource. A data value set represents a set of data values which have a logical relationship, usually from being captured off  the same data entry form. We follow the link to the HTML representation which will take us to <ulink url="http://apps.dhis2.org/demo/api/dataValueSets"/>. The default representation is a HTML page which provides us with  useful instructions on how to interact with this resources. It tells us that we can use the POST verb to send values using a XML format defined by the <emphasis role="italic">http://dhis2.org/schema/dxf/2.0</emphasis> namespace:</para>
    <screen>&lt;dataValueSet xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot; dataSet=&quot;dataSetID&quot; 
  completeDate=&quot;date&quot; period=&quot;period&quot; orgUnit=&quot;orgUnitID&quot;&gt;
  &lt;dataValue dataElement=&quot;dataElementID&quot; value=&quot;1&quot;/&gt;
  &lt;dataValue dataElement=&quot;dataElementID&quot; value=&quot;2&quot;/&gt;
  &lt;dataValue dataElement=&quot;dataElementID&quot; value=&quot;3&quot;/&gt;
&lt;/dataValueSet&gt;</screen>
    <para><emphasis role="italic">Note:</emphasis> We have omitted the <emphasis role="italic">categoryOptionCombo</emphasis> attribute as it is optional and not needed for this example. Please refer to the date and period section above for time formats.</para>
    <para>From the example we can see that we need to identify the period,  the data set, the org unit (facility) and the data elements for which to report. The <emphasis role="italic">dataValueSets</emphasis> resource description tells us that the identifier for monthly periods should be on the format <emphasis role="italic">yyyyMM</emphasis> which means that we will use <emphasis role="italic">201201</emphasis> for January 2012.</para>
    <para>To obtain the identifier for the data set we return to the the entry point at <ulink url="http://apps.dhis2.org/demo/api"/> and follow the embedded link pointing at the <emphasis role="italic">dataSets</emphasis> resource located at <ulink url="http://apps.dhis2.org/demo/api/dataSets"/>. From there we find and follow the link to the <emphasis role="italic">Mortality &lt; 5 years</emphasis> data set which leads us to <ulink url="http://apps.dhis2.org/demo/api/dataSets/pBOMPrpg1QX"/>. What we did was effectively to retrieve the HTML representation of our data set of interest, and from it we can easily see the identifier, which is <emphasis role="italic">pBOMPrpg1QX</emphasis>. The resource representation for the <emphasis role="italic">Mortality &lt; 5 years</emphasis> data set conveniently advertises links to the  data elements which are members of it. From here we can follow these links and obtain the identifiers of the data elements. For brevity we will only report on three data  elements: <emphasis role="italic">Measles</emphasis> with id <emphasis role="italic">f7n9E0hX8qk</emphasis>, <emphasis role="italic">Dysentery</emphasis> with id <emphasis role="italic">Ix2HsbDMLea</emphasis> and <emphasis role="italic">Cholera</emphasis> with id <emphasis role="italic">eY5ehpbEsB7</emphasis>.</para>
    <para>What remains is to get hold of the identifier of the facility (org unit). Again the <emphasis role="italic">dataSet</emphasis> representation conveniently provides link to org units which report on it so we search for<emphasis role="italic"> Ngelehun CHC</emphasis> and follow the link to the HTML representation at <ulink url="http://apps.dhis2.org/demo/api/organisationUnits/DiszpKrYNg8"/>, which tells us that the identifier of this org unit is <emphasis role="italic">DiszpKrYNg8</emphasis>.</para>
    <para>From our case-based data we assume that we have 12 cases of measles, 14 cases of dysentery and 16 cases of cholera. We have now gathered enough information to be able to put together the XML data value set message:</para>
    <screen>&lt;dataValueSet xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot; dataSet=&quot;pBOMPrpg1QX&quot; 
  completeDate=&quot;2012-02-03&quot; period=&quot;201201&quot; orgUnit=&quot;DiszpKrYNg8&quot;&gt;
  &lt;dataValue dataElement=&quot;f7n9E0hX8qk&quot; value=&quot;12&quot;/&gt;
  &lt;dataValue dataElement=&quot;Ix2HsbDMLea&quot; value=&quot;14&quot;/&gt;
  &lt;dataValue dataElement=&quot;eY5ehpbEsB7&quot; value=&quot;16&quot;/&gt;
&lt;/dataValueSet&gt;</screen>
    <para>To perform  functional testing we will use the cURL tool (<ulink url="http://curl.haxx.se"/>) which provides an easy way of transferring data using HTTP. First we save the data value set XML content in a file called <emphasis role="italic">datavalueset.xml</emphasis> . From the directory where this file resides we invoke the following from the command line:</para>
    <para><code>curl -d @datavalueset.xml &quot;http://apps.dhis2.org/demo/api/dataValueSets&quot; -H &quot;Content-Type:application/xml&quot; -u admin:district -v</code></para>
    <para>The command will dispatch a request to the demo Web API,  set <emphasis role="italic">application/xml</emphasis> as the content-type and  authenticate using admin/district as username/password.   If all goes well this will return a <emphasis role="italic">200 OK</emphasis> HTTP status code. You can verify that the data has been received by opening the data entry module in DHIS 2 and select the org unit, data set and period used in this example.</para>
    <para>The API follows normal semantics for error handling and HTTP status codes. If you supply an invalid username or password, <emphasis role="italic">401 Unauthorized</emphasis> is returned. If you supply a content-type other than application/xml, <emphasis role="italic">415 Unsupported Media Type</emphasis> is returned. If the XML content is invalid according to the DXF namespace, <emphasis role="italic">400 Bad Request</emphasis> is returned. If you provide an invalid identifier in the XML content, <emphasis role="italic">409 Conflict</emphasis> is returned together with a descriptive message.</para>
    <para>In this example, cURL will authenticate to the server through  Basic authentication using our supplied username and password as credentials through the <emphasis role="italic">-u</emphasis> flag. </para>
    <para>In a real-world scenario, looking up identifiers, constructing and dispatching XML messages would be the task of the client software application. This software would probably interact with the more machine-friendly XML and JSON resource representations and not the human-friendly HTML representations like we  did in this example. Developing creative and robust consumers of the Web API services begins  here.</para>
  </section>
  <section>
    <title>Sending single event no registration data values</title>
    <para>DHIS 2 supports 3 kinds of events, single events with no registration (previously called
      anonymous), single event with registration, and multiple events with registration. Currently
      only single event with no registration is supported in DXF2, support for additional event
      types will come later.</para>
    <para>The approach to sending events is very similar to sending aggregate data values, you will
      need a <emphasis role="italic">programId</emphasis>, <emphasis role="italic"
        >organisationUnitId</emphasis>, and a list of valid data element IDs. An example payload can
      be seen below (in XML and
      JSON):<screen>&lt;?xml version='1.0' encoding='utf-8'?>
&lt;event programId="nGREQllB95g" organisationUnitId="yFZVWkkk1QL" eventDate="2013-05-17"
    completed="true" storedBy="admin">
  &lt;coordinate latitude="59.8" longitude="10.9" />
  &lt;dataValues>
    &lt;dataValue dataElementId="WFhjqschUjD" value="2013-05-17" />
    &lt;dataValue dataElementId="QGfmQy0pxFU" value="-100" />
  &lt;/dataValues>
&lt;/event></screen><screen>{
	"programId": "nGREQllB95g",
	"organisationUnitId": "yFZVWkkk1QL",
	"eventDate": "2013-05-17",
	"completed": true,
	"storedBy": "admin",
	"coordinate": {
		"latitude": "59.8",
		"longitude": "10.9"
	},
	"dataValues": [
		{ "dataElementId": "WFhjqschUjD", "value": "2013-05-17" },
		{ "dataElementId": "QGfmQy0pxFU", "value": "-100" }
	]
}</screen></para>
    <para>We also support sending multiple events at the same time (be warned that this format might
      change for our next
      release):<screen>&lt;?xml version='1.0' encoding='utf-8'?>
&lt;events>
	&lt;eventList>
		&lt;event programId="nGREQllB95g" organisationUnitId="yFZVWkkk1QL" eventDate="2013-05-17"
            completed="true" storedBy="admin">
		  &lt;coordinate latitude="59.8" longitude="10.9" />
		  &lt;dataValues>
			&lt;dataValue dataElementId="WFhjqschUjD" value="2013-05-17" />
			&lt;dataValue dataElementId="QGfmQy0pxFU" value="-100" />
		  &lt;/dataValues>
		&lt;/event>

		&lt;event programId="nGREQllB95g" organisationUnitId="yFZVWkkk1QL" eventDate="2013-05-17"
            completed="true" storedBy="admin">
		  &lt;coordinate latitude="59.8" longitude="10.9" />
		  &lt;dataValues>
			&lt;dataValue dataElementId="WFhjqschUjD" value="2013-05-17" />
			&lt;dataValue dataElementId="QGfmQy0pxFU" value="-100" />
		  &lt;/dataValues>
		&lt;/event>
	&lt;/eventList>
&lt;/events></screen><screen>{
	"eventList": [
		{
			"programId": "nGREQllB95g",
			"organisationUnitId": "yFZVWkkk1QL",
			"eventDate": "2013-05-17",
			"completed": true,
			"storedBy": "admin",
			"coordinate": {
				"latitude": "59.8",
				"longitude": "10.9"
			},
			"dataValues": [
				{ "dataElementId": "WFhjqschUjD", "value": "2013-05-17" },
				{ "dataElementId": "QGfmQy0pxFU", "value": "-100" }
			]
		},
		{
			"programId": "nGREQllB95g",
			"organisationUnitId": "yFZVWkkk1QL",
			"eventDate": "2013-05-17",
			"completed": true,
			"storedBy": "admin",
			"coordinate": {
				"latitude": "59.8",
				"longitude": "10.9"
			},
			"dataValues": [
				{ "dataElementId": "WFhjqschUjD", "value": "2013-05-17" },
				{ "dataElementId": "QGfmQy0pxFU", "value": "-100" }
			]
		}
	]
}</screen></para>
    <para>Most of the elements here should be easy to understand already, but a table can be seen
      below that will explain what they all mean.</para>
    <para>
      <table>
        <title>XML/JSON element/key description</title>
        <tgroup cols="5">
          <thead>
            <row>
              <entry>
                <emphasis role="italic">Key</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Type</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Required</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Options (default first)</emphasis>
              </entry>
              <entry>
                <emphasis role="italic">Description</emphasis>
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>programId</entry>
              <entry>string</entry>
              <entry>true</entry>
              <entry/>
              <entry>UID pointing to the single event no registration program</entry>
            </row>
            <row>
              <entry>organisationUnitId</entry>
              <entry>string</entry>
              <entry>true</entry>
              <entry/>
              <entry>UID pointing to the organisation unit.</entry>
            </row>
            <row>
              <entry>eventDate</entry>
              <entry>date</entry>
              <entry>true</entry>
              <entry/>
              <entry>The date this event occured.</entry>
            </row>
            <row>
              <entry>completed</entry>
              <entry>boolean</entry>
              <entry>false</entry>
              <entry>Defaults to true.</entry>
              <entry>Is this event complete or not.</entry>
            </row>
            <row>
              <entry>storedBy</entry>
              <entry>string</entry>
              <entry>false</entry>
              <entry>Defaults to current user.</entry>
              <entry>Who stored this event (can be username, system-name etc)</entry>
            </row>
            <row>
              <entry>coordinate</entry>
              <entry>double</entry>
              <entry>false</entry>
              <entry>GPS coordinate where this event occured.</entry>
              <entry>For XML this is an element called coordinate with two attributes (latitude and longitude),
                for JSON this is an object with two keys (latitude and longitude)</entry>
            </row>
            <row>
              <entry>dataValue / dataElementId</entry>
              <entry>string</entry>
              <entry>true</entry>
              <entry></entry>
              <entry>UID of data element.</entry>
            </row>
            <row>
              <entry>dataValue / value</entry>
              <entry>string</entry>
              <entry>true</entry>
              <entry></entry>
              <entry>Value of captured data element.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </para>
  </section>
  <section>
    <title>Sending data values using SDMX-HD</title>
    <para>Posting a dataValueSet report formatted using the WHO SDMX-HD standard is very similar to
      the dxf2 example above. The same api/dataValueSets resource is used, but the client has to
      specify the Content-Type as <emphasis role="italic">application/sdmx+xml</emphasis>.</para>
    <para>The example below shows an SDMX-HD dataValueSet:</para>
    <screen><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<CrossSectionalData xmlns="http://www.SDMX.org/resources/SDMXML/schemas/v2_0/message" 
  xmlns:common="http://www.SDMX.org/resources/SDMXML/schemas/v2_0/common"
  xmlns:ns="urn:sdmx:org.sdmx.infomodel.keyfamily.KeyFamily=DHIS2:KF_DHIS2_SIMPLE:1.0:cross"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://www.SDMX.org/resources/SDMXML/schemas/v2_0/message SDMXMessage.xsd 
  urn:sdmx:org.sdmx.infomodel.keyfamily.KeyFamily=DHIS2:KF_DHIS2_SIMPLE:1.0:cross file:./KF_HOSP_cross.xsd">

  <Header>
    <ID>OpenMRS-Export</ID>
    <Test>false</Test>
    <Prepared>2012-03-21</Prepared>
    <Sender id="DDU"/>
  </Header>
  
  <ns:DataSet FREQ="M" TIME_PERIOD="2012-01" FACILITY="DDU" datasetID="KF_HOSP">
    <ns:Group>
      <ns:Section>
        <ns:OBS_VALUE DATAELEMENT="DE001" value="34" />
        <ns:OBS_VALUE DATAELEMENT="DE002" value="36" />
        <ns:OBS_VALUE DATAELEMENT="DE003" value="34" />
        <ns:OBS_VALUE DATAELEMENT="DE004" value="12" />
        <ns:OBS_VALUE DATAELEMENT="DE005" value="5" />
      </ns:Section>
    </ns:Group>
  
</ns:DataSet>
</CrossSectionalData>]]></screen>
    <para>One thing to note is that the SDMX-HD metadata for dataelements, orgunits and datasets are identified using <emphasis>codes</emphasis> rather than <emphasis>uids</emphasis>.
    Assuming these coded datasets are present in the DHIS2 server then this can be posted, for example using the curl command below.</para>
    <para><code>curl -d @sdmxdatavalueset.xml &quot;http://{server base url}/api/dataValueSets&quot; -H &quot;Content-Type:application/sdmx+xml&quot; -u admin:district -v</code></para>
  </section>
  <section>
    <title>Sending large bulks of data values</title>
    <para>The previous example showed us how to send a set of related data values sharing the same period and organisation unit. This example will show us how to send large bulks of data values which don&apos;t necessarily are logically related.</para>
    <para>Again we will interact with the with <ulink url="http://apps.dhis2.org/demo/api/dataValueSets"/> resource. This time we will not specify the dataSet and completeDate attributes. Also, we will specify the period and orgUnit attributes on the individual data value elements instead of on the outer data value set element. This will enable us to send data values for various periods and org units:</para>
    <screen>&lt;dataValueSet xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot;&gt;
  &lt;dataValue dataElement=&quot;f7n9E0hX8qk&quot; period=&quot;201201&quot; orgUnit=&quot;DiszpKrYNg8&quot; value=&quot;12&quot;/&gt;
  &lt;dataValue dataElement=&quot;f7n9E0hX8qk&quot; period=&quot;201201&quot; orgUnit=&quot;FNnj3jKGS7i&quot; value=&quot;14&quot;/&gt;
  &lt;dataValue dataElement=&quot;f7n9E0hX8qk&quot; period=&quot;201202&quot; orgUnit=&quot;DiszpKrYNg8&quot; value=&quot;16&quot;/&gt;
  &lt;dataValue dataElement=&quot;f7n9E0hX8qk&quot; period=&quot;201202&quot; orgUnit=&quot;Jkhdsf8sdf4&quot; value=&quot;18&quot;/&gt;
&lt;/dataValueSet&gt;</screen>
    <para>We test by using cURL  to send the data values:</para>
    <para><code>curl -d @datavalueset.xml &quot;http://apps.dhis2.org/demo/api/dataValueSets&quot; -H &quot;Content-Type:application/xml&quot; -u admin:district -v</code></para>
    <para>The data value set resource provides an XML response which is useful when you want to verify the impact your request had. The first time we send the data value set request above the server will respond with the following<emphasis role="italic"> import summary</emphasis>:</para>
    <screen>&lt;importSummary&gt;
  &lt;dataValueCount imported=&quot;2&quot; updated=&quot;1&quot; ignored=&quot;1&quot;/&gt;
  &lt;dataSetComplete&gt;false&lt;/dataSetComplete&gt;
&lt;/importSummary&gt;</screen>
    <para>This message tells us that 3 data values were imported, 1 data value was updated while zero data values were ignored. The single update comes as a result of us sending that data value in the previous example. A data value will be ignored if it references a non-existing data element, period, org unit or data set. In our case this single ignored value was caused by the last data value having an invalid reference to org unit. The data set complete element will display the date of which the data value set was completed, or false if no data element attribute was supplied.</para>
    <para>The import process can be customized using a set of import parameters:</para>
    <table>
      <title>Import parameters</title>
      <tgroup cols="3">
        <thead>
          <row>
            <entry>
              <emphasis role="italic">Parameter</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Values (default first)</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Description</emphasis>
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>dataElementIdScheme</entry>
            <entry>uid | name | code</entry>
            <entry>Which property on the data element object to reference from the XML attribute</entry>
          </row>
          <row>
            <entry>orgUnitIdScheme</entry>
            <entry>uid | name | code</entry>
            <entry>Which property on the org unit object to reference from the XML attribute</entry>
          </row>
          <row>
            <entry>dryRun</entry>
            <entry>false | true</entry>
            <entry>Whether to save changes on the server or just return the import summary</entry>
          </row>
          <row>
            <entry>importStrategy</entry>
            <entry>new_and_updates | new | updates</entry>
            <entry>Save objects of all, new or update import status on the server</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>All parameters are optional and can be supplied as query parameters in the request URL like this:</para>
    <screen>http://apps.dhis2.org/demo/api/dataValueSets?dataElementIdScheme=code&amp;
  orgUnitIdScheme=name&amp;dryRun=true&amp;importStrategy=new</screen>
    <para>They can also be supplied as XML attributes on the data value set element like below. XML attributes will override query string parameters.</para>
    <screen>&lt;dataValueSet xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot; dataElementIdScheme=&quot;code&quot; 
  orgUnitIdScheme=&quot;name&quot; dryRun=&quot;true&quot; importStrategy=&quot;new&quot;&gt;
  ..
&lt;/dataValueSet&gt;</screen>
    <para>Regarding the id schemes, by default the  identifiers used in the XML messages refer to the DHIS stable object identifiers. In certain interoperability situations we might experience that the external system  decides the identifiers of the objects. In that case we can use the <emphasis role="italic">code</emphasis> property of the organisation unit and data element objects to set fixed identifiers dictated by the other system. When importing data values we hence need to reference the code property instead of the uid property, and can do so using the dataElementIScheme and orgUnitIdScheme paramaters.</para>
  </section>
  <section>
    <title>Reading data values</title>
    <para>This section explains how to retrieve data values from the Web API by interacting with the dataValueSets resource. Data values can currently be retrieved in XML format. Since we want to read data we will use the <emphasis role="italic">GET</emphasis> HTTP verb. We will also specify that we are interested in the XML resource representation by including an <emphasis role="italic">Accept</emphasis> HTTP header with our request. The following query parameters are required:</para>
    <table>
      <title>Data value set query parameters</title>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>
              <emphasis role="italic">Parameter</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Description</emphasis>
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>dataSet</entry>
            <entry>Data set identifier</entry>
          </row>
          <row>
            <entry>period</entry>
            <entry>Period identifier in ISO format</entry>
          </row>
          <row>
            <entry>orgUnit</entry>
            <entry>Organisation unit identifier</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>It is assumed that we have posted data values to DHIS according to the previous section called &quot;Sending data values&quot;. We can now put together our request and send it using cURL:</para>
    <para><code>curl
        &quot;http://apps.dhis2.org/demo/api/dataValueSets?dataSet=pBOMPrpg1QX</code><code>&amp;period=201201&amp;orgUnit=DiszpKrYNg8&quot;
        -H &quot;Accept:application/xml&quot; -u admin:district -v</code></para>
    <para>The  response will look something like this:</para>
    <screen>HTTP/1.1 200 OK
Content-Type: application/xml

&lt;?xml version=&apos;1.0&apos; encoding=&apos;UTF-8&apos;?&gt;
&lt;dataValueSet xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot; dataSet=&quot;pBOMPrpg1QX&quot;
  completeDate=&quot;2012-01-02&quot; period=&quot;201201&quot; orgUnit=&quot;DiszpKrYNg8&quot;&gt;
&lt;dataValue dataElement=&quot;eY5ehpbEsB7&quot; period=&quot;201201&quot; orgUnit=&quot;DiszpKrYNg8&quot; 
  categoryOptionCombo=&quot;bRowv6yZOF2&quot; value=&quot;10003&quot;/&gt;
&lt;dataValue dataElement=&quot;Ix2HsbDMLea&quot; period=&quot;201201&quot; orgUnit=&quot;DiszpKrYNg8&quot; 
  categoryOptionCombo=&quot;bRowv6yZOF2&quot; value=&quot;10002&quot;/&gt;
&lt;dataValue dataElement=&quot;f7n9E0hX8qk&quot; period=&quot;201201&quot; orgUnit=&quot;DiszpKrYNg8&quot; 
  categoryOptionCombo=&quot;bRowv6yZOF2&quot; value=&quot;10001&quot;/&gt;
&lt;/dataValueSet&gt;</screen>
    <para>The header tells us that the request was processed successfully and that we are receiving a response in XML format. The XML message looks familiar - it is the data values we sent in the previous section.</para>
  </section>
  <section>
    <title>Reading large bulks of data values</title>
    <para>This section explains how to retrieve large bulks of data values which not necessarily
      belong in a single data value set. We will, like in the previous section, interact with the
      dataValueSets resource. The query parameters to use are these:</para>
    <table frame="all">
      <title>Data value set query parameters</title>
      <tgroup cols="2">
        <colspec colname="c1" colnum="1" colwidth="195pt"/>
        <colspec colname="c2" colnum="2" colwidth="605.25pt"/>
        <thead>
          <row>
            <entry><emphasis role="italic">Parameter</emphasis></entry>
            <entry><emphasis role="italic">Description</emphasis></entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>dataSet</entry>
            <entry>Data set identifier, can be specified multiple times</entry>
          </row>
          <row>
            <entry>startDate</entry>
            <entry>Start date for the time span of the values to export</entry>
          </row>
          <row>
            <entry>endDate</entry>
            <entry>End date for the time span of the values to export</entry>
          </row>
          <row>
            <entry>orgUnit</entry>
            <entry>Organisation unit identifier, can be specified multiple times</entry>
          </row>
          <row>
            <entry>children</entry>
            <entry>Whether to include the children in the hierarchy of the organisation
              units</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>The dataSet and orgUnit parameters can be repeated in order to include multiple data sets
      and organisation units. An example request looks like this:</para>
    <para><code>curl
        "http://apps.dhis2.org/demo/api/dataValueSets?dataSet=pBOMPrpg1QX&amp;dataSet=BfMAe6Itzgt&amp;startDate=2013-01-01&amp;endDate=2013-01-31&amp;orgUnit=YuQRtpLP10I&amp;orgUnit=vWbkYPRmKyS&amp;children=true"
        -H "Accept:application/xml" -u admin:district -v</code></para>
    <para>You can get the response in <emphasis role="italic">xml</emphasis> and <emphasis
        role="italic">csv</emphasis> format. You can indicate which response format you prefer
      through the <emphasis role="italic">Accept</emphasis> HTTP header like in the example above.
      For xml you use <emphasis role="italic">application/xml</emphasis>; for csv you use <emphasis
        role="italic">application/csv</emphasis>.</para>
  </section>
  <section>
    <title>Writing and reading messages</title>
    <para>DHIS 2 features a mechanism for sending messages for purposes such as user feedback, notifications and general information to  users. Messages are delivered to the DHIS 2 message inbox but can also be sent to the user&apos;s email addresses and mobile phones as SMS. In this example we will see how we can utilize the Web API to send and read messages. We will pretend to be the <emphasis role="italic">DHIS Administrator</emphasis>   user  and  send a message to the  <emphasis role="italic">Mobile</emphasis> user. We will then pretend to be the  mobile user and read our new message.</para>
    <para>The resource we need to interact with when sending and reading messages is the <emphasis role="italic">messageConversations</emphasis> resource. We start by visiting the Web API entry point at <ulink url="http://apps.dhis2.org/demo/api"/> where we find and follow the link to the <emphasis role="italic">messageConversations</emphasis> resource at <ulink url="http://apps.dhis2.org/demo/api/messageConversations"/>. The description tells us that we can use a POST request to create a new message using the following XML format:</para>
    <para><screen>&lt;message xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot;&gt;
  &lt;subject&gt;This is the subject&lt;/subject&gt;
  &lt;text&gt;This is the text&lt;/text&gt;
  &lt;users&gt;
    &lt;user id=&quot;user1ID&quot; /&gt;
    &lt;user id=&quot;user2ID&quot; /&gt;
    &lt;user id=&quot;user3ID&quot; /&gt;
  &lt;/users&gt;
&lt;/message&gt;</screen></para>
    <para>Since we want to send a message to our friend the mobile user we need to look up her identifier. We do so by going to the  Web API entry point and follow the link to the <emphasis role="italic">users</emphasis> resource at <ulink url="http://apps.dhis2.org/demo/api/users"/>. We continue by following link to the mobile user at <ulink url="http://apps.dhis2.org/demo/api/users/PhzytPW3g2J"/> where we learn that her identifier is <emphasis role="italic">PhzytPW3g2J</emphasis>. We are now ready to put our XML message together to form a message where we want to ask the mobile user whether she has reported data for January 2012:</para>
    <screen>&lt;message xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot;&gt;
  &lt;subject&gt;Mortality data reporting&lt;/subject&gt;
  &lt;text&gt;Have you reported data for the Mortality data set for January 2012?&lt;/text&gt;
  &lt;users&gt;
    &lt;user id=&quot;PhzytPW3g2J&quot; /&gt;
  &lt;/users&gt;
&lt;/message&gt;</screen>
    <para>To test this we save the XML content into a file called <emphasis role="italic">message.xml</emphasis>. We use cURL to dispatch the message the the DHIS 2 demo instance where we indicate that the content-type is XML and authenticate as the <emphasis role="italic">admin</emphasis> user:</para>
    <para><code>curl -d @message.xml &quot;http://apps.dhis2.org/demo/api/messageConversations&quot; -H &quot;Content-Type:application/xml&quot; -u admin:district -X POST -v</code></para>
    <para>If all is well we receive a <emphasis role="italic">201 Created</emphasis> HTTP status code. Also note that we receive a <emphasis role="italic">Location </emphasis>HTTP header which value  informs us of the URL of the newly  created message conversation resource - this can be used by a consumer to perform further action.</para>
    <para>We will now pretend to be the mobile user and read the message which was just sent by dispatching a GET request to the <emphasis role="italic">messageConversations</emphasis> resource. We supply an <emphasis role="italic">Accept</emphasis> header with <emphasis role="italic">application/xml</emphasis> as the value to indicate that we are interested in the XML resource representation and we authenticate as the <emphasis role="italic">mobile</emphasis> user:</para>
    <para><code>curl &quot;http://apps.dhis2.org/demo/api/messageConversations&quot; -H &quot;Accept:application/xml&quot; -u mobile:district -X GET -v</code></para>
    <para>In response we get the following XML:</para>
    <screen>&lt;messageConversations xmlns=&quot;http://dhis2.org/schema/dxf/2.0&quot;
  link=&quot;http://apps.dhis2.org/demo/api/messageConversations&quot;&gt;
  &lt;messageConversation name=&quot;Mortality data reporting&quot; id=&quot;ZjHHSjyyeJ2&quot;
    link=&quot;http://apps.dhis2.org/demo/api/messageConversations/ZjHHSjyyeJ2&quot;/&gt;
  &lt;messageConversation name=&quot;DHIS version 2.7 is deployed&quot; id=&quot;GDBqVfkmnp2&quot;
    link=&quot;http://apps.dhis2.org/demo/api/messageConversations/GDBqVfkmnp2&quot;/&gt;
&lt;/messageConversations&gt;</screen>
    <para>From the response we are able to read the identifier of the newly sent message which is <emphasis role="italic">ZjHHSjyyeJ2</emphasis>. Note that the link to the specific resource is embedded and can be followed in order to read the full message. From the description at <ulink url="http://apps.dhis2.org/demo/api/messageConversations"/> we learned that we can reply directly to an existing message conversation once we know the URL by including the message text as the  request payload (body). We are now able to construct a URL for sending our reply:</para>
    <para><code>curl -d &quot;Yes the Mortality data set has been reported&quot; &quot;http://apps.dhis2.org/demo/api/messageConversations/ZjHHSjyyeJ2&quot; -H &quot;Content-Type:text/plain&quot; -u mobile:district -X POST -v</code> </para>
    <para>If all went according to plan you will receive a <emphasis role="italic">200 OK</emphasis> status code.</para>
  </section>
  <section>
    <title>Writing interpretations</title>
    <para>For certain analysis-related resources in DHIS, like charts and report tables, one can share a data interpretation. An interpretation is simply a link to the the relevant resource together with a text expressing some insight about the data. Currently an interpretation can be viewed by all users in the system.</para>
    <para>We will start by writing an interpretation for the chart with identifier <emphasis role="italic">EbRN2VIbPdV</emphasis>. To write chart interpretations we will interact with the <ulink url="http://apps.dhis2.org/demo/api/interpretations/chart/{chartId}"/> resource. The interpretation will be the request body. Based on this we can put together the following request using cURL:</para>
    <para><code>curl -d &quot;This chart shows a significant ANC 1-3 dropout&quot; &quot;http://apps.dhis2.org/demo/api/interpretations/chart/EbRN2VIbPdV&quot; -H &quot;Content-Type:text/plain&quot; -u admin:district -v</code></para>
    <para>Second we will write a comment on the interpretation we just wrote. By looking at the interpretation response you will see that a <emphasis role="italic">Location</emphasis> header is returned. This header tells us the URL of the newly created interpretation and from that we can read its identifier. This identifier is randomly generated so you will have to replace the one in the command below with your own. To write a comment we can interact with the <ulink url="http://apps.dhis2.org/demo/api/interpretations/{interpretationId}/comment"/> like this:</para>
    <para><code>curl -d &quot;An intervention is needed&quot; &quot;http://apps.dhis2.org/demo/api/interpretations/j8sjHLkK8uY/comment&quot; -H &quot;Content-Type:text/plain&quot; -u admin:district -v</code></para>
    <para>You can also write interpretations for report tables in a similar way by interacting with the <ulink url="http://app.dhis2.org/demo/api/interpretations/reportTable/{reportTableId}"/>. For report tables you can also provide an optional <emphasis role="italic">ou</emphasis> query parameter to supply an organisation unit identifier in the case where the report table has an organisation unit report parameter:</para>
    <para><code>curl -d &quot;This table reveals poor data quality&quot; &quot;http://apps.dhis2.org/demo/api/interpretations/reportTable/xIWpSo5jjT1?ou=O6uvpzGd5pu&quot; -H &quot;Content-Type:text/plain&quot; -u admin:district -v</code></para>
  </section>
  <section>
    <title>Embedding reports in web pages</title>
    <para>In this example we will see how we can build a simple web page  where dynamic data such as tabular reports is pulled from the DHIS Web API. A full example on how this can done is available at <ulink url="http://apps.dhis2.org/portal"/>.</para>
    <para>The Web API contains several resources which are useful for data analysis: <emphasis role="italic">report</emphasis>, <emphasis role="italic">reportTable</emphasis>, <emphasis role="italic">chart</emphasis>, <emphasis role="italic">map</emphasis> and <emphasis role="italic">document</emphasis>. Dispatching  GET requests to the mentioned resources will return meta-data information such as name and the date it was last updated. All these resources have an associated <emphasis role="italic">data</emphasis> resource which produces a data view of  related aggregated data - also  known as  reports, charts and maps. You can follow the links or simply append <emphasis role="italic">/data</emphasis> to the URL to arrive at it. This information can be represented in a variety of formats including HTML, PDF, Excel, PNG and Jasper, as we will see in the next section.</para>
    <para>We  start as usual at the Web API entrypoint at <ulink url="http://apps.dhis2.org/demo/api"/>. We look for a relevant  report table by following the <emphasis role="italic">reportTables</emphasis> link to <ulink url="http://apps.dhis2.org/demo/api/reportTables"/>. We assume that we are interested in the &quot;District Maternal Health&quot; report and follow the link to <ulink url="http://apps.dhis2.org/demo/api/reportTables/xIWpSo5jjT1"/>. This resource provides meta-data information about the report table. From here we can follow the link to the default data view of aggregated data, which leads us to  <ulink url="http://apps.dhis2.org/demo/api/reportTables/xIWpSo5jjT1/data"/>. As we can see we are provided with a  report table in HTML format, which is the default representation format for report tables.</para>
    <para>As stated in the introduction there are three ways of indicating which resource representation format you prefer for the response. The most suitable alternative for direct use in web pages is to append a file suffix to the URL. We assume that we are interested in the PDF representation and indicate that by appending <emphasis role="italic">.pdf</emphasis> to our URL: <ulink url="http://apps.dhis2.org/demo/api/reportTables/xIWpSo5jjT1/data.pdf"/>. Go ahead and try out all valid extensions for this resource which are <emphasis role="italic">.html</emphasis>, <emphasis role="italic">.pdf</emphasis>, <emphasis role="italic">.xls</emphasis> and <emphasis role="italic">.csv</emphasis>.</para>
    <para>The report table can be parameterized with an organisation unit and a period by supplying a <emphasis role="italic">ou</emphasis> and <emphasis role="italic">pe</emphasis> query parameter accompanied with an organisation unit  identifier and period string  in the URL. If not provided the Web API will use the top-most organisation unit in the hierarchy and the last  period for the report table content. The organisation unit identifier can be looked up by going to the Web API entrypoint and follow the link to the <emphasis role="italic">organisationUnits</emphasis> resouce. For our example we will use <emphasis role="italic">Bo</emphasis> district whith identifier <emphasis role="italic">O6uvpzGd5pu</emphasis> as the organisation unit: <ulink url="http://apps.dhis2.org/demo/api/reportTables/xIWpSo5jjT1/data?ou=O6uvpzGd5pu"/>. From the HTML representation we can  see that the report now contains data for <emphasis role="italic">Bo</emphasis> district. These URLs can  simply  be used in links embedded in the web page like this:</para>
    <screen>&lt;a href=&quot;http://apps.dhis2.org/demo/api/reportTables/xIWpSo5jjT1/data.pdf?
ou=O6uvpzGd5pu&quot;&gt;Maternal Health Bo District 2012&lt;/a&gt;</screen>
    <para>There are many ways to authenticate over the Web and each method has its advantages and disadvantages. For this example we will use an  approach where we emulate a  login from the web-based login form. To help us we will use the <emphasis role="italic">jQuery</emphasis> JavaScript library. This JavaScript code should be embedded in the <emphasis role="italic">head</emphasis> section of the Web page:</para>
    <screen>jQuery(document).ready(function() {
  $.post( &quot;http://apps.dhis2.org/demo/dhis-web-commons-security/login.action&quot;, {
      j_username: &quot;admin&quot;, j_password: &quot;district&quot; 
    }
  );
});</screen>
    <para>In this code block we ask jQuery to send a POST request to the standard authentication point with two name-value pairs containing the username and password information. We assume that the user has the necessary authorities to view reports in the DHIS 2 Web API. If  authentication was successful the server will send a HTTP cookie in the response with a session identifier. This will make sure that the current user is authorized to view reports for up to 60 minutes.</para>
    <para>Caveat:  The username and password will be present in the web page in plain text. Make sure  you create a dedicated user in DHIS 2 for this purpose provided only with the minimum authorities required. For a more robust way of exposing resources without requiring authentication see the the section on reverse proxy setup in the installation chapter.</para>
    <para>For a full example visit <ulink url="http://apps.dhis2.org/portal"/> and view the page source in a browser. Note that the example web page is hosted within the same domain (apps.dhis2.org) as the demo DHIS 2 instance. This is done to avoid issues related to the &quot;same origin policy&quot;, a concept which prevents scripts hosted on one domain to access resources running on another. While one can circumvent this through techniques such as <emphasis role="italic">CORS</emphasis>, there are none which have wide browser support at the moment. Therefore we recommend hosting web pages and portals on the same domain. Techniques using reverse proxies described in the &quot;installation&quot; chapter can be useful in this regard. Finally we provide some sample URLs pointing to various data resources for your inspiration:</para>
    <itemizedlist>
      <listitem>
        <para><ulink url="http://apps.dhis2.org/demo/api/maps/JlXSUIcLsmd/data"/></para>
      </listitem>
      <listitem>
        <para><ulink url="http://apps.dhis2.org/demo/api/maps/data?in=JIVMtpjVZqJ&amp;ou=O6uvpzGd5pu"/></para>
      </listitem>
      <listitem>
        <para><ulink url="http://apps.dhis2.org/demo/api/reports/Cb2BcgxBUPz/data"/></para>
      </listitem>
      <listitem>
        <para><ulink url="http://apps.dhis2.org/demo/api/charts/nwqNUFG9Vky/data"/></para>
      </listitem>
      <listitem>
        <para><ulink url="http://apps.dhis2.org/demo/api/charts/data?in=JIVMtpjVZqJ&amp;ou=O6uvpzGd5pu"/></para>
      </listitem>
      <listitem>
        <para><ulink url="http://apps.dhis2.org/demo/api/charts/data?in=JIVMtpjVZqJ&amp;ou=O6uvpzGd5pu&amp;periods=true"/></para>
      </listitem>
      <listitem>
        <para><ulink url="http://apps.dhis2.org/demo/api/documents/MfHNQx51HT9/data"/></para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Embedding charts with the Visualizer chart plug-in</title>
    <para>In this example we will see how we can embed good-looking Ext JS charts (<ulink url="http://www.sencha.com/products/extjs"/>) with data served from a DHIS back-end into a Web page. To accomplish this we will use the DHIS Visualizer plug-in. The plug-in is written in Javascript and depends on the Ext JS library only. A complete working example can be found at <ulink url="http://apps.dhis2.org/portal/chart.html"/>. Open the page in a web browser and view the source to see how it is set up.</para>
    <para>We start by including three required Javascript files in the header section of the HTML document. The first file is the  Ext JS Javascript library (we use  the Google content delivery network in this case). The third file is the Visualizer plug-in. Make sure the path is pointing to your DHIS server installation.</para>
    <screen>&lt;script type=&quot;text/javascript&quot;
  src=&quot;http://extjs-public.googlecode.com/svn/tags/extjs-4.0.7/release/ext-all.js&quot;&gt;
&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;
  src=&quot;http://apps.dhis2.org/demo/dhis-web-visualizer/app/plugin/plugin.js&quot;&gt;
&lt;/script&gt;</screen>
    <para>To authenticate with the DHIS server we use the same approach as in the previous section. In the header of the HTML document we include the following Javascript inside a script element. The <emphasis role="italic">setLinks</emphasis> method will be implemented later. Make sure the <emphasis role="italic">base</emphasis> variable is pointing to your DHIS installation.</para>
    <screen>var base = &apos;http://apps.dhis2.org/demo/&apos;;

Ext.onReady( function() {
  Ext.Ajax.request({ 
    url: base + &quot;dhis-web-commons-security/login.action&quot;,
    method: &apos;POST&apos;,
    params: { j_username: &quot;admin&quot;, j_password: &quot;district&quot; },
    success: setLinks
  });
});</screen>
    <para>Now let us have a look at the various options for the Visualizer plug-in. If you want to refer to pre-defined charts already made inside DHIS you should use the <emphasis role="italic">uid</emphasis> parameter. If you want create dynamic charts you shoud include the indicators and/or dataelements parameter and omit the uid parameter. Asterisk (*) indicates that a parameter is required only when the uid  parameter is not used.</para>
    <table>
      <title>Visualizer chart plug-in configuration</title>
      <tgroup cols="5">
        <thead>
          <row>
            <entry>
              <emphasis role="italic">Param</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Type</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Required</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Options (default first)</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Description</emphasis>
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>uid</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry/>
            <entry>Identifier of a pre-defined chart in DHIS</entry>
          </row>
          <row>
            <entry>type</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry>column | stackedcolumn | bar | stackedbar | line | area | pie</entry>
            <entry>Chart type</entry>
          </row>
          <row>
            <entry>indicators</entry>
            <entry>[string]</entry>
            <entry>Yes*</entry>
            <entry/>
            <entry>Identifiers of indicators to include in chart</entry>
          </row>
          <row>
            <entry>dataelements</entry>
            <entry>[string]</entry>
            <entry>Yes*</entry>
            <entry/>
            <entry>Identifiers of data elements to include in chart</entry>
          </row>
          <row>
            <entry>periods</entry>
            <entry>[string]</entry>
            <entry>No</entry>
            <entry>last12Months | lastMonth | lastQuarter | last4Quarters | lastSixMonth | last2SixMonths | thisYear | last5Years</entry>
            <entry>Names of relative periods to include in chart</entry>
          </row>
          <row>
            <entry>organisationunits</entry>
            <entry>[string]</entry>
            <entry>Yes*</entry>
            <entry/>
            <entry>Identifiers of organisation units to include in chart</entry>
          </row>
          <row>
            <entry>series</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry>data | period | organisationunit</entry>
            <entry>Dimension to use as chart series</entry>
          </row>
          <row>
            <entry>category</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry>data | period | organisationunit</entry>
            <entry>Dimension to use as chart category</entry>
          </row>
          <row>
            <entry>filter</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry>data | period | organisationunit</entry>
            <entry>Dimension to use as chart filter</entry>
          </row>
          <row>
            <entry>orgUnitIsParent</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether the chart should display the children of the selected org units</entry>
          </row>
          <row>
            <entry>skipAnimation</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether the initial chart animation should be displayed</entry>
          </row>
          <row>
            <entry>showData</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether to display data on the chart</entry>
          </row>
          <row>
            <entry>trendLine</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether to display trend line(s) on the chart</entry>
          </row>
          <row>
            <entry>hideLegend</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether to hide the chart legend</entry>
          </row>
          <row>
            <entry>hideSubtitle</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether to hide the chart title</entry>
          </row>
          <row>
            <entry>userOrganisationUnit</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether the user of the current user should be included in the chart</entry>
          </row>
          <row>
            <entry>userOrganisationUnitChildren</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether the child org units of the current user should be included in the chart</entry>
          </row>
          <row>
            <entry>targetLineValue</entry>
            <entry>double</entry>
            <entry>No</entry>
            <entry/>
            <entry>Value of target line to display on the chart</entry>
          </row>
          <row>
            <entry>targetLineLabel</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry/>
            <entry>Label for target line</entry>
          </row>
          <row>
            <entry>baseLineValue</entry>
            <entry>double</entry>
            <entry>No</entry>
            <entry/>
            <entry>Value of baseline to display on the chart</entry>
          </row>
          <row>
            <entry>baseLineLabel</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry/>
            <entry>Label for baseline</entry>
          </row>
          <row>
            <entry>domainAxisLabel</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry/>
            <entry>Label for the domain axis</entry>
          </row>
          <row>
            <entry>rangeAxisLabel</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry/>
            <entry>Label for the range axis</entry>
          </row>
          <row>
            <entry>el</entry>
            <entry>string</entry>
            <entry>Yes</entry>
            <entry/>
            <entry>Identifier of HTML element to render the chart in</entry>
          </row>
          <row>
            <entry>url</entry>
            <entry>string</entry>
            <entry>Yes</entry>
            <entry/>
            <entry>Base URL of the DHIS server</entry>
          </row>
          <row>
            <entry>width</entry>
            <entry>integer</entry>
            <entry>No</entry>
            <entry/>
            <entry>Width of chart</entry>
          </row>
          <row>
            <entry>height</entry>
            <entry>integer</entry>
            <entry>No</entry>
            <entry/>
            <entry>Height of chart</entry>
          </row>
          <row>
            <entry>legendPosition</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry>top | right | bottom | left</entry>
            <entry>Position of chart legend</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>We continue by including two pre-defined charts and to dynamic charts to our HTML document. You can browse the list of available charts using the Web API here: <ulink url="http://apps.dhis2.org/demo/api/charts"/>.</para>
    <screen>function setLinks() {
  DHIS.getChart({ uid: &apos;R0DVGvXDUNP&apos;, el: &apos;chartA1&apos;, url: base });

  DHIS.getChart({ uid: &apos;X0CPnV6uLjR&apos;, el: &apos;chartA2&apos;, url: base });


  DHIS.getChart({ el: &apos;chartB1&apos;, url: base,
    type: &apos;bar&apos;,
    indicators: [&apos;FnYCr2EAzWS&apos;,&apos;eTDtyyaSA7f&apos;,&apos;tUIlpyeeX9N&apos;],
    periods: &apos;last12Months&apos;,
    organisationunits: [&apos;ImspTQPwCqd&apos;]
  });

  DHIS.getChart({ el: &apos;chartB2&apos;, url: base,
    type: &apos;column&apos;,
    indicators: [&apos;Uvn6LCg7dVU&apos;,&apos;sB79w2hiLp8&apos;],
    periods: &apos;thisYear&apos;,
    organisationunits: [&apos;O6uvpzGd5pu&apos;,&apos;fdc6uOvgoji&apos;,&apos;lc3eMKXaEfw&apos;,&apos;jmIPBj66vD6&apos;],
    series: &apos;data&apos;,
    category: &apos;organisationunit&apos;,
    filter: &apos;period&apos;
  });
};</screen>
    <para>Finally we include some <emphasis role="italic">div</emphasis> elements in the body section of the HTML document with the identifiers referred to in the plug-in Javascript.</para>
    <screen>&lt;div id=&quot;chartA1&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;chartA2&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;

&lt;div id=&quot;chartB1&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;chartB2&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;</screen>
    <para>To see a complete working example please visit <ulink url="http://apps.dhis2.org/portal/chart.html"/>.</para>
  </section>
  <section>
    <title>Creating a chart carousel with the carousel plug-in</title>
    <para>The chart plug-in also makes it possible to create a chart carousel which for instance can be used to create an attractive front page on a Web portal. To use the carousel we need to import a few  files in the head section of our HTML page:</para>
    <screen>
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://apps.dhis2.org/demo/dhis-web-commons/javascripts/ext/resources/css/ext-plugin-gray.css&quot; /&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://apps.dhis2.org/demo/dhis-web-commons/javascripts/ext-ux/carousel/css/carousel.css&quot; /&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;http://extjs-public.googlecode.com/svn/tags/extjs-4.0.7/release/ext-all.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;http://apps.dhis2.org/demo/dhis-web-commons/javascripts/ext-ux/carousel/Carousel.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;http://apps.dhis2.org/demo/dhis-web-commons/javascripts/plugin/plugin.js&quot;&gt;&lt;/script&gt;</screen>
    <para>The first file is the CSS stylesheet for the chart plug-in. The second file is the CSS stylesheet for the carousel widget. The third file is the Ext JavaScript framework which this plug-in depends on. The fourth file is the carousel plug-in JavaScript file. The fifth file is the chart plug-in JavaScript file. The paths in this example points at the DHIS 2 demo site, make sure you update them to point to your own DHIS 2 installation.</para>
    <para>Please refer to the section about the chart plug-in on how to do authentication.</para>
    <para>To create a chart carousel we will first render the charts we want to include in the carousel using the method described in the chart plug-in section. Then we create the chart carousel itself. The charts will be rendered into <emphasis role="italic">div</emphasis> elements which all have a CSS class called <emphasis role="italic">chart</emphasis>. In the carousel configuration we can then define a <emphasis role="italic">selector</emphasis> expression which refers to those div elements like this:</para>
    <screen>DHIS.getChart({ uid: &apos;R0DVGvXDUNP&apos;, el: &apos;chartA1&apos;, url: base });
DHIS.getChart({ uid: &apos;X0CPnV6uLjR&apos;, el: &apos;chartA2&apos;, url: base });
DHIS.getChart({ uid: &apos;j1gNXBgwKVm&apos;, el: &apos;chartA3&apos;, url: base });
DHIS.getChart({ uid: &apos;X7PqaXfevnL&apos;, el: &apos;chartA4&apos;, url: base });

new Ext.ux.carousel.Carousel( &apos;chartCarousel&apos;, {
  autoPlay: true,
  itemSelector: &apos;div.chart&apos;,
  interval: 5,
  showPlayButton: true
});</screen>
    <para>The first argument in the configuration is  the id of the div element in which you want to render the carousel. The <emphasis role="italic">autoPlay</emphasis> configuration option refers to whether we want the carousel to start when the user loads the Web page. The <emphasis role="italic">interval</emphasis> option defines how many seconds each chart should be displayed. The <emphasis role="italic">showPlayButton</emphasis> defines whether we want to render a button for the user to start and stop the carousel. Finally we need to insert the div elements in the body of the HTML document:</para>
    <screen>&lt;div id=&quot;chartCarousel&quot;&gt;

&lt;div id=&quot;chartA1&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;chartA2&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;chartA3&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;chartA4&quot; class=&quot;chart&quot;&gt;&lt;/div&gt;</screen>
    <para>To see a complete working example please visit <ulink url="http://apps.dhis2.org/portal/carousel.html"/>.</para>
  </section>
  <section>
    <title>Embedding report tables with the table plug-in</title>
    <para>In this example we will see how we can embed dynamic data tables in a Web page with data provided from a DHIS back-end server using the table plug-in. The table plug-in resides inside the same file as the chart plug-in so please refer to the  section about the chart plug-in  above on how to include the required JavaScript and CSS files and how to do authentication. The available table options are listed in the table below.</para>
    <table>
      <title>Table plug-in configuration</title>
      <tgroup cols="5">
        <thead>
          <row>
            <entry>
              <emphasis role="italic">Param</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Type</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Required</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Options (default first)</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Description</emphasis>
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>indicators</entry>
            <entry>[string]</entry>
            <entry>Yes*</entry>
            <entry/>
            <entry>Identifiers of indicators to include in table</entry>
          </row>
          <row>
            <entry>dataelements</entry>
            <entry>[string]</entry>
            <entry>Yes*</entry>
            <entry/>
            <entry>Identifiers of data elements to include in table</entry>
          </row>
          <row>
            <entry>datasets</entry>
            <entry>[string]</entry>
            <entry>Yes*</entry>
            <entry/>
            <entry>Identifiers of data sets to include in table</entry>
          </row>
          <row>
            <entry>periods</entry>
            <entry>[string]</entry>
            <entry>No</entry>
            <entry>last12Months | lastMonth | lastQuarter | last4Quarters | lastSixMonth | last2SixMonths | thisYear | last5Years</entry>
            <entry>Names of relative periods to include in table</entry>
          </row>
          <row>
            <entry>orgunits</entry>
            <entry>[string]</entry>
            <entry>Yes</entry>
            <entry/>
            <entry>Identifiers of organisation units to include in table</entry>
          </row>
          <row>
            <entry>orgUnitIsParent</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether the table should display the children of the selected org units</entry>
          </row>
          <row>
            <entry>crosstab</entry>
            <entry>string[]</entry>
            <entry>No</entry>
            <entry>data | periods | orgunit</entry>
            <entry>Which data dimension should be crosstabulated and used as columns </entry>
          </row>
          <row>
            <entry>hiddenCols</entry>
            <entry>int[]</entry>
            <entry>No</entry>
            <entry/>
            <entry>Zero-based index of the columns in the table which should be hidden</entry>
          </row>
          <row>
            <entry>useExtGrid</entry>
            <entry>boolean</entry>
            <entry>No</entry>
            <entry>false | true</entry>
            <entry>Whether the table should be rendered as plain HTML or as an Ext JS Grid</entry>
          </row>
          <row>
            <entry>el</entry>
            <entry>string</entry>
            <entry>Yes</entry>
            <entry/>
            <entry>Identifier of HTML element to render the table in</entry>
          </row>
          <row>
            <entry>url</entry>
            <entry>string</entry>
            <entry>Yes</entry>
            <entry/>
            <entry>Base URL of the DHIS server</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>In the following are examples on how the table plug-in can be used.</para>
    <screen>DHIS.getTable({
  indicators: [&apos;Uvn6LCg7dVU&apos;],
  periods: [&apos;last12Months&apos;],
  orgunits: [&apos;ImspTQPwCqd&apos;],
  crosstab: [&apos;periods&apos;],
  orgUnitIsParent: true,
  useExtGrid: false,
  callbackName: &apos;table1&apos;,
  hiddenCols: [0],
  el: &apos;table1&apos;,
  url: base
});

DHIS.getTable({
  dataelements: [&apos;s46m5MS0hxu&apos;, &apos;YtbsuPPo010&apos;, &apos;xc8gmAKfO95&apos;, &apos;UOlfIjgN8X6&apos;],
  periods: [&apos;last4Quarters&apos;],
  orgunits: [&apos;ImspTQPwCqd&apos;],
  crosstab: [&apos;data&apos;],
  useExtGrid: false,
  callbackName: &apos;table2&apos;,
  el: &apos;table2&apos;,
  url: base
});</screen>
    <para>Finally we insert in the Web page the div elements which are referred to in the table configuration and used to render the tables.</para>
    <screen>&lt;div id=&quot;table1&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;table2&quot;&gt;&lt;/div&gt;</screen>
    <para>To view a complete working example please visit <ulink url="http://apps.dhis2.org/portal/table.html"/>.</para>
    <para>You can also choose to provide a link to the report table instead of rendering it directly on the web page. The configuration of the link function is very similar to the table function and shares the <emphasis role="italic">indicators</emphasis>, <emphasis role="italic">dataelements</emphasis>, <emphasis role="italic">datasets</emphasis>, <emphasis role="italic">periods</emphasis>, <emphasis role="italic">orgunits</emphasis>, <emphasis role="italic">orgUnitIsParent</emphasis>, <emphasis role="italic">crosstab</emphasis> and <emphasis role="italic">url</emphasis> properties. There is only one additional parameter which is listed in the table below.</para>
    <table>
      <title>Link plug-in (additional) configuration</title>
      <tgroup cols="5">
        <thead>
          <row>
            <entry>
              <emphasis role="italic">Param</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Type</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Required</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Options (default first)</emphasis>
            </entry>
            <entry>
              <emphasis role="italic">Description</emphasis>
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>format</entry>
            <entry>string</entry>
            <entry>No</entry>
            <entry>html | xls | csv | pdf | json | xml</entry>
            <entry>The representation format of the table, can be HTML, Excel, CSV, PDF, JSON and XML</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>Below is an example on how to use the link function. The link URL is retrieved from the <emphasis role="italic">getUrl</emphasis> function and later set as target for a link the HTML document.</para>
    <screen>var url1 = DHIS.getUrl({
  indicators: [&apos;Uvn6LCg7dVU&apos;],
  periods: [&apos;last12Months&apos;],
  orgunits: [&apos;ImspTQPwCqd&apos;],
  crosstab: [&apos;periods&apos;],
  orgUnitIsParent: true,
  format: &apos;xls&apos;,
  url: base
});

Ext.get(&apos;link1&apos;).set({href: url1});</screen>
    <para>The link HTML element can be defined in the body section of the document like below.</para>
    <screen>&lt;a id=&quot;link1&quot;&gt;Download as Excel&lt;/a&gt;</screen>
    <para>To view a complete working example please visit <ulink url="http://apps.dhis2.org/portal/table.html"/>.</para>
  </section>
  <section>
    <title>Working with SQL views</title>
    <para>SQL views are useful for presenting certain data views externally, which may be more
      easily constructed with SQL than by combining the multiple objects of the Web API. As an
      example, lets assume we have been asked to provide a view of all organization units with their
      names, parent names, organization unit level and name, and the coordinates listed in the
      database. The view might look something like this: </para>
    <screen>SELECT ou.name as orgunit, par.name as parent, ou.coordinates, ous.level, oul.name from organisationunit ou  
INNER JOIN _orgunitstructure ous ON ou.organisationunitid = ous.organisationunitid
INNER JOIN organisationunit par ON ou.parentid = par.organisationunitid
INNER JOIN orgunitlevel oul ON ous.level = oul.level
WHERE ou.coordinates is not null 
ORDER BY oul.level, par.name, ou.name</screen>
    <para>We will use <command>curl</command> to first execute the view on the DHIS 2 server. This
      is essentially a materialization process, and ensures that we have the most recent data
      available through the SQL view when it is retrieved from the server. You can first look up the
      SQL view from the api/sqlViews resource, then POST using the following command:</para>
    <screen>curl &quot;http://apps.dhis2.org/demo/api/sqlViews/dI68mLkP1wN/execute&quot; -X POST -u admin:district -v</screen>
    <para>The next step in the process is the retrieval of the data.The basic structure of the URL is as follows</para>
    <screen>http://{server}/api/sqlViews/{uid}/data(.csv)</screen>
    <para>The <parameter>{server}</parameter> parameter should be replaced with your own server. The
      next part of the URL <parameter>/api/sqlViews/</parameter> should be appended with the
      specific unique identifier (not the internal ID of the view). Append either
        <parameter>data</parameter> for XML data or <parameter>data.csv</parameter> for comma
      delimited values. As an example, the following command would retrieve XML data for the SQL
      view defined
      above.<screen>curl &quot;http://apps.dhis2.org/dev/api/sqlViews/dI68mLkP1wN/data.csv&quot; -u admin:district -v</screen></para>
    <para>You can do simple filtering on the columns in the result set by appending <emphasis
        role="italic">criteria</emphasis> query parameters to the URL, using the column names and
      filter values separated by columns as parameter values, on the following format:</para>
    <screen>/data?criteria=col1:value1&amp;criteria=col2:value2</screen>
    <para>As an example, to filter the SQL view result set above to only return organisation units
      at level 4 you can use the following URL:</para>
    <screen>http://apps.dhis2.org/dev/api/sqlViews/dI68mLkP1wN/data.csv?level:4</screen>
  </section>
  <section>
    <title>Analytics</title>
    <para>To access analytical, aggregated data in DHIS 2 you can work with the <emphasis
        role="italic">analytics</emphasis> resource. The analytics resource is powerful as it lets
      you query and retrieve data aggregated along all available data dimensions. For instance, you
      can ask the analytics resource to provide the aggregated data values for a set of data
      elements, periods and organisation units. Also, you can retrieve the aggregated data for a
      combination of any number of dimensions based on data elements and organisation unit group
      sets.</para>
    <para>DHIS 2 features a multi-dimensional data model with several fixed and dynamic data
      dimensions. The fixed dimensions are the data element, period (time) and organisation unit
      dimension. You can dynamically add dimensions through categories, data element group sets and
      organisation unit group sets. The table below displays the available data dimensions in DHIS
      2. Each data dimension has a corresponding <emphasis role="italic">dimension
        identifier</emphasis>, and each dimension can have a set of <emphasis role="italic"
        >dimension items</emphasis>:</para>
    <itemizedlist>
      <listitem>
        <table frame="all">
          <title>Dimensions and dimension items</title>
          <tgroup cols="3">
            <colspec colname="c1" colnum="1" colwidth="3.17*"/>
            <colspec colname="c2" colnum="2" colwidth="1*"/>
            <colspec colname="newCol3" colnum="3" colwidth="4.03*"/>
            <thead>
              <row>
                <entry><emphasis role="italic">Dimension</emphasis></entry>
                <entry><emphasis role="italic">Dimension id</emphasis></entry>
                <entry><emphasis role="italic">Dimension items</emphasis></entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Data elements, indicators and data set reporting rates</entry>
                <entry>dx</entry>
                <entry>Data elements, indicators and data set identifiers</entry>
              </row>
              <row>
                <entry>Periods (time)</entry>
                <entry>pe</entry>
                <entry>ISO periods and relative periods, see "date and period format"</entry>
              </row>
              <row>
                <entry>Organisation unit hierarchy</entry>
                <entry>ou</entry>
                <entry>Organisation unit identifiers, USER_ORGUNIT | USER_ORGUNIT_CHILDREN and
                  LEVEL-&lt;level>-&lt;boundary-id></entry>
              </row>
              <row>
                <entry>Category option combinations</entry>
                <entry>co</entry>
                <entry>Not possible to define dimension items - all relevant items are
                  returned</entry>
              </row>
              <row>
                <entry>Data element group sets</entry>
                <entry>&lt;group set id></entry>
                <entry>Data element group identifiers (omit to get all items)</entry>
              </row>
              <row>
                <entry>Organisation unit group sets</entry>
                <entry>&lt;group set id></entry>
                <entry>Organisation unit group identifiers (omit to get all items)</entry>
              </row>
              <row>
                <entry>Categories</entry>
                <entry>&lt;category id></entry>
                <entry>Category option identifiers (omit to get all items)</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </listitem>
    </itemizedlist>
    <para>The base URL to the analytics resource is <emphasis role="italic"
      >api/analytics</emphasis>. To request specific dimensions and dimension items you can use a
      query string on the following format, where <emphasis role="italic">dim-id</emphasis> and
        <emphasis role="italic">dim-item</emphasis> should be substituted with real values:</para>
    <screen>api/analytics?dimension=dim-id:dim-item;dim-item&amp;dimension=dim-id:dim-item;dim-item</screen>
    <para>As illustrated above, the dimension identifier is followed by a colon while the dimension
      items are separated by semi-colons. As an example, a query for two data elements, two periods
      and two organisation units can be done with the following URL:</para>
    <screen>api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&amp;dimension=pe:2012Q1;2012Q2&amp;dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw</screen>
    <para>To query for data broken down by category option combinations instead of data element
      totals you can include the category dimension in the query string, for instance like
      this:</para>
    <screen>api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&amp;dimension=co&amp;dimension=pe:201201&amp;dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw</screen>
    <para>To query for organisation unit group sets and data elements you can use the following URL
      - notice how the group set identifier is used as dimension identifier and the groups as
      dimension items:</para>
    <screen>api/analytics?dimension=Bpx0589u8y0:oRVt7g429ZO;MAs88nJc9nL&amp;dimension=pe:2012&amp;dimension=ou:ImspTQPwCqd</screen>
    <para>To query for data elements and categories you can use this URL - use the category
      identifier as dimension identifier and the category options as dimension items:</para>
    <screen>api/analytics?dimension=dx:s46m5MS0hxu;fClA2Erf6IO&amp;dimension=pe:2012&amp;dimension=YNZyaJHiHYq:btOyqprQ9e8;GEqzEKCHoGA&amp;filter=ou:ImspTQPwCqd</screen>
    <para>To query using relative periods and organisation units associated with the current user
      you can use a URL like this:</para>
    <screen>api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&amp;dimension=pe:LAST_12_MONTHS&amp;dimension=ou:USER_ORGUNIT</screen>
    <para>A few things to be aware of when using the analytics resource are listed below.</para>
    <itemizedlist>
      <listitem>
        <para>Data elements, indicator and data sets are part of a common data dimension, identified
          as "dx". This means that you can use any of data elements, indicators and data set
          identifiers together with the "dx" dimension identifier in a query.</para>
      </listitem>
      <listitem>
        <para>For the data element group set and organisation unit group set dimensions, all
          dimension items will be used in the query if no dimension items are given for the
          dimension.</para>
      </listitem>
      <listitem>
        <para>For the period dimension, the dimension items are ISO period identifiers and/or
          relative periods. Please refer to the section above called "Date and period format" for
          the period format and available relative periods.</para>
      </listitem>
      <listitem>
        <para>For the organisation unit dimension you can specify the items to be the organisation
          unit or sub-units of the organisation unit associated with the user currently
          authenticated for the request using they keys USER_ORGUNIT or USER_ORGUNIT_CHILDREN as
          items, respectively. You can also specify organisation unit identifiers directly, or a
          combination of both.</para>
      </listitem>
      <listitem>
        <para>For the organisation unit dimension you can specify the organisation hierarchy level
          and the boundary unit to use for the request on the format
          LEVEL-&lt;level>-&lt;boundary-id>; as an example LEVEL-3-ImspTQPwCqd implies all
          organisation units below the given boundary unit at level 3 in the hierarchy.</para>
      </listitem>
      <listitem>
        <para>For the organisation unit dimension the dimension items are the organisation units and
          their sub-hierarchy - data will be aggregated for all organisation units below the given
          organisation unit in the hierarchy.</para>
      </listitem>
      <listitem>
        <para>You cannot specify dimension items for the category option combination dimension.
          Instead the response will contain the items which are linked to the data values.</para>
      </listitem>
    </itemizedlist>
    <section>
      <title>Request query parameters</title>
    <para>The analytics resource lets you specify a range of query parameters:<table frame="all">
          <title>Query parameters</title>
          <tgroup cols="4">
            <colspec colname="c1" colnum="1" colwidth="2.44*"/>
            <colspec colname="newCol2" colnum="2" colwidth="1*"/>
            <colspec colname="c2" colnum="3" colwidth="3.67*"/>
            <colspec colname="c3" colnum="4" colwidth="2.65*"/>
            <thead>
              <row>
                <entry><emphasis role="italic">Query parameter</emphasis></entry>
                <entry><emphasis role="italic">Required</emphasis></entry>
                <entry><emphasis role="italic">Description</emphasis></entry>
                <entry><emphasis role="italic">Options</emphasis></entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>dimension</entry>
                <entry>Yes</entry>
                <entry>Dimensions to be retrieved, repeated for each</entry>
                <entry>Any dimension</entry>
              </row>
              <row>
                <entry>filter</entry>
                <entry>No</entry>
                <entry>Filters to apply to the query, repeated for each</entry>
                <entry>Any dimension</entry>
              </row>
              <row>
                <entry>aggregationType</entry>
                <entry>No</entry>
                <entry>Aggregation type to use in the aggregation process</entry>
                <entry>SUM | AVERAGE_INT |  AVERAGE_INT_DISAGGREGATION |  AVERAGE_BOOL |
                  COUNT</entry>
              </row>
              <row>
                <entry>measureCriteria</entry>
                <entry>No</entry>
                <entry>Filters for the data/measures</entry>
                <entry>EQ | GT | GE | LT | LE</entry>
              </row>
              <row>
                <entry>skipMeta</entry>
                <entry>No</entry>
                <entry>Exclude the meta data part of response (improves performance)</entry>
                <entry>false | true</entry>
              </row>
              <row>
                <entry>tableLayout</entry>
                <entry>No</entry>
                <entry>Use plain data source or table layout for response</entry>
                <entry>false | true</entry>
              </row>
              <row>
                <entry>columns</entry>
                <entry>No</entry>
                <entry>Dimensions to use as columns for table layout</entry>
                <entry>Any dimension (must be query dimension)</entry>
              </row>
              <row>
                <entry>rows</entry>
                <entry>No</entry>
                <entry>Dimensions to use as rows for table layout</entry>
                <entry>Any dimension (must be query dimension)</entry>
              </row>
            </tbody>
          </tgroup>
        </table>The <emphasis role="italic">dimension</emphasis> query parameter defines which
        dimensions should be included in the analytics query. Any number of dimensions can be
        specified. The dimension parameter should be repeated for each dimension to include in the
        query response. The query response can potentially contain aggregated values for all
        combinations of the specified dimension items.</para>
    <para>The <emphasis role="italic">filter</emphasis> parameter defines which dimensions should be
        used as filters for the data retrieved in the analytics query. Any number of filters can be
        specified. The filter parameter should be repeated for each filter to use in the query. A
        filter differs from a dimension in that the filter dimensions will not be part of the query
        response content, and that the aggregated values in the response will be collapsed on the
        filter dimensions. In other words, the data in the response will be aggregated on the filter
        dimensions, but the filters will not be included as dimensions in the actual response. As an
        example, to query for certain data elements filtered by the periods and organisation units
        you can use the following URL:</para>
    <screen>api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&amp;filter=pe:2012Q1;2012Q2&amp;filter=ou:O6uvpzGd5pu;lc3eMKXaEfw</screen>
    <para>The <emphasis role="italic">aggregationType</emphasis> query parameter lets you define
        which aggregation operator should be used for the query. By default the aggregation operator
        defined for data elements included in the query will be used. If your query does not contain
        any data elements, but does include data element groups, the aggregation operator of the
        first data element in the first group will be used. The order of groups and data elements is
        undefined. This query parameter allows you to override the default and specify a specific
        aggregaton operator. As an example you can set the aggregation operator to "count" with the
        following URL:</para>
    <screen>api/analytics?dimension=dx:fbfJHSPpUQD&amp;dimension=pe:2012Q1&amp;dimension=ou:O6uvpzGd5pu&amp;aggregationType=COUNT</screen>
    <para>The <emphasis role="italic">measureCriteria</emphasis> query parameter lets you filter out
      ranges of data records to return. You can instruct the system to return only records where the
      aggregated data value is equal, greater than, greater or equal, less than or less or equal to
      certain values. You can specify any number of criteria on the following format, where
        <emphasis role="italic">critieria</emphasis> and <emphasis role="italic">value</emphasis>
      should be substituted with real values:</para>
    <screen>api/analytics?measureCriteria=criteria:value;criteria:value</screen>
    <para>As an example, the following query will return only records where the data value is
        greater or equal to 6500 and less than 33000:</para>
    <screen>api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&amp;dimension=pe:2012&amp;dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw&amp;measureCriteria=GE:6500;LT:33000</screen>
      <para>In order to have the analytics resource generate the data in the shape of a ready-made
        table, you can provide the <emphasis role="italic">tableLayout</emphasis> parameter with
        true as value. Instead of generating a plain, normalized data source, the analytics resource
        will now generate the data in table layout. You can use the <emphasis role="italic"
          >columns</emphasis> and <emphasis role="italic">rows</emphasis> parameters with dimension
        identifiers separated by semi-colons as values to indicate which ones to use as table
        columns and rows. The column and rows dimensions must be present as a data dimension in the
        query (not a filter). Such a request can look like this:</para>
      <screen>api/analytics.html?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&amp;dimension=pe:2012Q1;2012Q2&amp;dimension=ou:O6uvpzGd5pu&amp;tableLayout=true&amp;columns=dx;ou&amp;rows=pe</screen>
    </section>
    <section>
      <title>Response formats</title>
      <para>The analytics response containing aggregate data can be returned in various
        representation formats. As usual, you can indicate interest in a specific format by
        appending a file extension to the URL, through the <emphasis role="italic">Accept</emphasis>
        HTTP header or through the <emphasis role="italic">format</emphasis> query parameter. The
        default format is JSON. The available formats and content-types are listed below.</para>
      <itemizedlist>
        <listitem>
          <para>json (application/json)</para>
        </listitem>
        <listitem>
          <para>jsonp (application/javascript)</para>
        </listitem>
        <listitem>
          <para>xml (application/xml)</para>
        </listitem>
        <listitem>
          <para>csv (application/csv)</para>
        </listitem>
        <listitem>
          <para>html (text/html)</para>
        </listitem>
        <listitem>
          <para>xls (application/vnd.ms-excel)</para>
        </listitem>
      </itemizedlist>
      <para>As an example, to request an analytics response in XML format you can use the following
        URL:</para>
      <screen>api/analytics.xml?dimension=dx:fbfJHSPpUQD&amp;dimension=pe:2012&amp;dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw</screen>
      <para>The analytics responses must be retrieved using the HTTP <emphasis role="italic"
          >GET</emphasis> method. This allows for direct linking to analytics responses from Web
        pages as well as other HTTP-enabled clients. To do functional testing we can use the cURL
        library. By executing this command against the demo database you will get an analytics
        response in JSON format:</para>
      <screen>curl "apps.dhis2.org/demo/api/analytics.json?dimension=dx:eTDtyyaSA7f;FbKK4ofIv5R&amp;dimension=pe:2012Q1;2012Q2&amp;filter=ou:ImspTQPwCqd" -u admin:district</screen>
      <para>The JSON response will look like this:</para>
      <screen>{
    "headers": [
        {
            "name": "dx", 
            "column": "Data", 
            "meta": true, 
            "type": "java.lang.String"
        }, 
        {
            "name": "pe", 
            "column": "Period", 
            "meta": true, 
            "type": "java.lang.String"
        }, 
        {
            "name": "value", 
            "column": "Value", 
            "meta": false, 
            "type": "java.lang.Double"
        }
    ], 
    "height": 4, 
    "metaData": {
        "pe": [
            "2012Q1",
            "2012Q2"
        ],
        "names": {
            "2012Q1": "Jan to Mar 2012",
            "2012Q2": "Apr to Jun 2012",
            "FbKK4ofIv5R": "Measles Coverage &lt;1 y",
            "ImspTQPwCqd": "Sierra Leone",
            "eTDtyyaSA7f": "Fully Immunized Coverage"
        }
    }, 
    "rows": [
        [
            "eTDtyyaSA7f", 
            "2012Q2", 
            "81.1"
        ], 
        [
            "eTDtyyaSA7f", 
            "2012Q1", 
            "74.7"
        ], 
        [
            "FbKK4ofIv5R", 
            "2012Q2", 
            "88.9"
        ], 
        [
            "FbKK4ofIv5R", 
            "2012Q1", 
            "84.0"
        ]
    ], 
    "width": 3
}
</screen>
      <para>The response represents a table of dimensional data. The <emphasis role="italic"
          >headers</emphasis> array gives an overview of which columns are included in the table and
        what the columns contain. The <emphasis role="italic">column</emphasis> property shows the
        column dimension identifier, or if the column contains measures, the word "Value". The
          <emphasis role="italic">meta</emphasis> property is <emphasis role="italic"
          >true</emphasis> if the column contains dimension items or <emphasis role="italic"
          >false</emphasis> if the column contains a measure (aggregated data values). The <emphasis
          role="italic">name</emphasis> property is similar to the column property, except it
        displays "value" in case the column contains a measure. The <emphasis role="italic"
          >type</emphasis> property indicates the Java class type of the column values.</para>
      <para>The <emphasis role="italic">height</emphasis> and <emphasis role="italic"
          >width</emphasis> properties indicate how many data columns and rows are contained in the
        response, respectively.</para>
      <para>The <emphasis role="italic">metaData periods</emphasis> property contains a unique,
        ordered list of the periods included in the response. The <emphasis role="italic">metaData
          names</emphasis> property contains a mapping between the identifiers used in the data
        response and the names of the objects they represent. It can be used by clients to
        substitute the identifiers within the data response with names in order to give a more
        meaningful view of the data table.</para>
      <para>The <emphasis role="italic">rows</emphasis> array contains the dimensional data table.
        It contains columns with dimension items (object or period identifiers) and a column with
        aggregated data values. The example response above has a data/indicator column, a period
        column and a value column. The first column contains indicator identifiers, the second
        contains ISO period identifiers and the third contains aggregeted data values.</para>
    </section>
    <section>
      <title>Constraints</title>
      <para>There are several constraints on the input you can provide to the analytics
        resource.</para>
      <itemizedlist>
        <listitem>
          <para>At least one dimension must be specified in a query.</para>
        </listitem>
        <listitem>
          <para>Dimensions cannot be specified as dimension and filter simultaneously.</para>
        </listitem>
        <listitem>
          <para>At least one period must be specified as dimension or filter.</para>
        </listitem>
        <listitem>
          <para>Indicators, data sets and categories cannot be specified as filters.</para>
        </listitem>
        <listitem>
          <para>Data element group sets cannot be specified together with data sets.</para>
        </listitem>
        <listitem>
          <para>Categories can only be specified together with data elements, not indicators or data
            sets.</para>
        </listitem>
        <listitem>
          <para>A dimension cannot be specified more than once.</para>
        </listitem>
        <listitem>
          <para>Fixed dimensions ("dx", "pe", "ou") must have at least one option if included in a
            query.</para>
        </listitem>
        <listitem>
          <para>A table cannot potentially contain more than 5000 cells for performance
            reasons.</para>
        </listitem>
      </itemizedlist>
      <para>When a query request violates any of these constraints the server will return a response
        with status code 409 and content-type "text/plain" together with a textual description of
        the problem.</para>
    </section>
  </section>
  <section>
    <title>Generating resource, analytics and data mart tables</title>
    <para>DHIS 2 features a set of generated database tables which are used as basis for various
      system functionality. These tables can be executed immediately or scheduled to be executed at
      regular intervals through the user interface. They can also be generated through the Web API
      as explained in this section. This task is typically one for a system administrator and not
      consuming clients. </para>
    <para>The resource tables are used internally by the DHIS 2 application for various analysis
      functions. These tables are also valuable for users writing advanced SQL reports. They can be
      generated with a PUT request to the following URL:</para>
    <screen>http://&lt;server-url>/api/resourceTables</screen>
    <para>The analytics tables are optimized for data aggregation and used currently in DHIS 2 for
      the pivot table module. The analytics tables can be generated with a PUT request to:</para>
    <screen>http://&lt;server-url>/api/resourceTables/analytics</screen>
    <para>The data mart is tables containing pre-calculated aggregated data which are used by DHIS 2
      analysis modules and can be used directly by SQL reports. The data mart tables can be
      generated with a PUT request to:</para>
    <screen>http://&lt;server-url>/api/resourceTables/dataMart</screen>
    <para>These requests will return immediately and initiate a server-side process.</para>
  </section>
  <section>
    <title>FRED API</title>
    <para>DHIS 2 from version 2.11 implements support for the current draft
      of the FRED API version 1.0. The project defines itself as <quote>open standard for sharing and updating
        health facility data</quote>. The full specification, including representation format and basic usage, can be found at <ulink
        url="http://facilityregistry.org/">http://facilityregistry.org/</ulink>.</para>
    <para>Since version 1.0 is not finalized there are parts of the current specification that has not
      been implemented as we found it not to be in a stable enough state. Most notably we do not
      currently support sorting (we do however sort on name by default) and filtering of facilities.</para>
    <para>The entry point for the implementation can be found at http://&lt;server-url>/api-fred
      and the current version is located at http://&lt;server-url>/api-fred/v1.</para>
    <para>This section will give some simple examples of using the API.</para>
        <para>Get all facilities:</para>
        <screen>curl -u username:password -X GET http://&lt;server-url>/api-fred/v1/facilities.json</screen>
        <para>Get a specific facility based on either UID or UUID:</para>
        <screen>curl -u username:password -X GET http://&lt;server-url>/api-fred/v1/facilities/UID.json
curl -u username:password -X GET http://&lt;server-url>/api-fred/v1/facilities/UUID.json</screen>
        <para>Create a new facility:</para>
        <screen>curl -u username:password -X POST -d @new_facility.json
  -H "Content-Type: application/json" http://&lt;server-url>/api-fred/v1/facilities.json</screen>
        <para>Update a facility:</para>
        <screen>curl -u username:password -X POST -d @updated_facility.json
  -H "Content-Type: application/json" http://&lt;server-url>/api-fred/v1/facilities/UID.json</screen>
<screen>
curl -u username:password -X POST -d @updated_facility.json
  -H "Content-Type: application/json" http://&lt;server-url>/api-fred/v1/facilities/UUID.json</screen>
  </section>
</chapter>
