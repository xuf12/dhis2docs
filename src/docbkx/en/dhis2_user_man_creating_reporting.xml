<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" []>
<chapter>
  <title>Setting up report functionality</title>
  <section>
    <title>Data sources for reporting</title>
    <section>
      <title>Types of data and aggregation</title>
      <para>In the bigger picture of HIS terminology all data in DHIS are usually called aggregated as they are aggregates (e.g. monthly summaries) of medical records or some kind of service registers reported from the health facilities. Aggregation inside DHIS however, which is the topic here, is concerned with how the raw data captured in DHIS (through data entry or import)are further aggregated over time (e.g. from monthly to quarterly values) or up the organisational hierarchy (e.g. from facility to district values). 
</para>
      <section>
        <title>Terminology</title>
        <itemizedlist>
          <listitem>
            <para><emphasis>Raw data</emphasis> refers to data that is registered into the DHIS 2 either through data entry or data import, and has not been manipulated by the DHIS aggregation process. All these data are stored in the table (or Java object if you prefer) called DataValue.
 </para>
          </listitem>
          <listitem>
            <para><emphasis>Aggregated data</emphasis> refers to data that has been aggregated by the DHIS 2, meaning it is no longer raw data, but some kind of aggregate of the raw data.</para>
          </listitem>
          <listitem>
            <para><emphasis>Indicator values</emphasis> can also be understood as aggregated data, but these are special in the way that they are calculated based on user defined formulas (factor * numerator/denominator). Indicator values are therefore processed data and not raw data, and are located in the aggregatedindicatorvalue table/object. Indicators are calculated at any level of the organisational hierarchy and these calculations are then based on the aggregated data values available at each level. A level attribute in the aggregateddatavalue table refers to the organisational level of the orgunit the value has been calculated for.
    </para>
          </listitem>
          <listitem>
            <para>
    <emphasis>Period and Period type</emphasis> are used to specify the time dimension of the raw or aggregated values, and data can be aggregated from one period type to another, e.g from monthly to quarterly, or daily to monthly. Each data value has one period and that period has one period type. E.g data values for the periods Jan, Feb, and Mar 2009, all of the monthly period type can be aggregated together to an aggregated data value with the period Q1 2009 and period type Quarterly.
   </para>
          </listitem>
        </itemizedlist>
      </section>
      <section>
        <title>Basic rules of aggregation</title>
        <section>
          <title>What is added together</title>
          <para>Data (raw) can be registered at any organisational level, e.g. at at national hospital at level 2, a health facility at level 5, or at a bigger PHC at level 4. This varies form country to country, but DHIS is flexible in allowing data entry or data import to take place at any level. This means that orgunits that themselves have children can register data, sometimes the same data elements as their children units. The basic rule of aggregation in DHIS 2 is that <emphasis>all raw data is aggregated together</emphasis>, meaning data registered at a facility on level 5 is added to the data registered for a PHC at level 4.</para>
          <para>
It is up to the user/system administrator/designer to make sure that no duplication of data entry is taking place and that e.g. data entered at level 4 are not about the same services/visits that are reported by orgunit children at level 5. NOTE that in some cases you want to have duplication of data in the system, but in a controlled manner. E.g. when you have two different sources of data for population estimates, both level 5 catchment population data and another population data source for level 4 based on census data (because sum of level 5 catchments is not always the same as level 4 census data). Then you can specify using advanced aggregation settings (see further down) that the system should e.g. not add level 5 population data to the level 4 population data, and that level 3,2,1 population data aggregates are only based on level 4 data and does not include level 5 data.</para>
        </section>
        <section>
          <title>How data gets added together</title>
          <para>How data is aggregated depends on the dimension of aggregation (see further down).</para>
          <para>Along the orgunit level dimension data is always summed up, simply added together. Note that raw data is never percentages, and therefore can be summed together. Indicator values that can be percentages are treated differently (re-calculated at each level, never summed up).</para>
          <para>
Along the time dimension there are several possibilities, the two most common ways to aggregate are sum and average. The user can specify for each data element which method to use by setting the aggregation operator (see further down). Monthly service data are normally summed together over time, e.g. the number of vaccines given in a year is the sum of the vaccines given for each month of that year. For population, equipment, staff and other kind of what is often called semi-permanent data the average method is often the one to use, as, e.g. &apos;number of nurses&apos; working at a facility in a year would not be the sum of the two numbers reported in the six-monthly staffing report, but rather the average of the two numbers. More details further down under &apos;aggregation operators&apos;. 
</para>
        </section>
      </section>
      <section>
        <title>Dimensions of aggregation</title>
        <section>
          <title>Organisational units and levels</title>
          <para>Organisational units are used to represent the &apos;where&apos; dimension associated with data values. In DHIS 2, organisational units are arranged in a hierarchy, which typically corresponds to the hierarchical nature of the organisation or country. Organisational unit levels correspond to the distinct levels within the hierarchy. For instance, a country may be organized into provinces, then districts, then facilities, and then sub-centers. This organisational hierarchy would have five levels. Within each level, a number of organisational units would exist. During the aggregation process, data is aggregated from the lower organisational unit levels to higher levels. Depending on the aggregation operator, data may be &apos;summed&apos; or &apos;averaged&apos; within a given organisational unit level, to derive the aggregate total for all the organisational units that are contained within a higher level organisational unit level. For instance, if there are ten districts contained in a province and the aggregation operator for a given data element has been defined as &apos;SUM&apos;,  the aggregate total for the province would be calculated as the sum of the values of the individual ten distrincts contained in that province.</para>
        </section>
        <section>
          <title>Period</title>
          <para>Periods are used to represent the &apos;when&apos; dimension associated with data values. Data can easily be aggregated from weeks to months, from months to quarters, and from quarters to years. DHIS 2 uses known rules of how these different intervals are contained within other intervals (for instance Quarter 1 2010 is known to contain January 2010, February 2010 an March 2010) in order to aggregate data from smaller time intervals, e.g. weeks, into longer time intervals, e.g. months. </para>
        </section>
        <section>
          <title>Data Elements and Categories</title>
          <para>The data element dimension specifies &apos;what&apos; is being recorded by a particular data value. Data element categories are actually degenerated dimensions of the data element dimension, and are used to disaggregate the data element dimension into finer categories. Data element categories, such as &apos;Age&apos; and &apos;Gender&apos;, are used to record a particular data element, typically for different population groups. These categories can then be used to calculate the overall total for the category  and the total of all categories. </para>
        </section>
      </section>
      <section>
        <title>Aggregation operators, methods for aggregation</title>
        <section>
          <title>Sum</title>
          <para>The &apos;sum&apos; operator simply calcuates the sum of all data values that are contained within a particular aggregation matrix. For instance, if data is recorded on a monthly basis at the district level and is aggregated to provincial quarterly totals, all data contained in all districts for a given province and all weeks for the given quarter will be added together to obtaine the aggregate total.</para>
        </section>
        <section>
          <title>Average</title>
          <para>When the average aggregation operator is selected, the unweighted average of all data values within a given aggregation matrix are calculated. </para>
          <para>It is important to understand how DHIS 2 treats null values in the context of the average operator. It is fairly common for some organisational units not to submit data for certain data elements. In the context of the average operator, the average results from the number of data elemements that are actually present (therefore NOT NULL) within a given aggregation matrix. If there are 12 districts within a given province, but only 10 of these have submitted data, the average aggreate will result from these ten values that are actually present in the database, and will not take into account the missing values.  </para>
        </section>
        <section>
          <title>Count</title>
          <para/>
        </section>
        <section>
          <title>Where to specify </title>
          <para/>
        </section>
      </section>
      <section>
        <title>Advanced aggregation settings (aggregation levels)</title>
        <section>
          <title>Aggregation levels</title>
          <para>The normal rule of the system is to aggregate all raw data together when moving up the organisational hierarchy, and the system assumes that data entry is not being duplicated by entering the same services provided to the same clients at both facility level and also entering an &apos;aggregated&apos; (sum of all facilities) number at a higher level. This is to more easily facilitate aggregation when the same services are provided but to different clients/catchment populations at facilities on level 5 and a PHC (the parent of the same facilities) at level 4. In this way a facility at level 5 and a PHC at level 4 can share the same data elements and simply add together their numbers to provide the total of services provided in the geographical area.</para>
          <para>Sometimes such an aggregation is not desired, simply because it would mean duplicating data about the same population. This is the case when you have two different sources of data for two different orgunit levels. E.g. catchment population for facilities can come from a different source than district populations and therefore the sum of the facility catchment populations do not match the district population provided by e.g. census data. If this is the case we would actually want duplicated data in the system so that each level can have as accurate numbers as possible, but then we do NOT want to aggregate these data sources together.
</para>
          <para>In the Data Element section you can edit data elements and for each of them specify how aggregation is done for each level. In the case described above we need to tell the system NOT to include facility data on population in any of the aggregations above that level, as the level above, in this case the districts have registered their population directly as raw data. The district population data should then be used at all levels above and including the district level, while facility level should use its own data.</para>
        </section>
        <section>
          <title>How to edit data element aggregation</title>
          <para>This is controlled through something called aggregation levels and at the end of the edit data element screen there is a tick-box called Aggregation Levels. If you tick that one you will see a list of aggregation levels, available and selected. Default is to have no aggregation levels defined, then all raw data in the hierarchy will be added together. To specify the rule described above, and given a hierarchy of Country, Province, District, Facility: select Facility and District as your aggregation levels. Basically you select where you have data. Selecting Facility means that Facilities will use data from facilities (given since this is the lowest level). Selecting District means that the District level raw data will be used when aggregating data for District level (hence no aggregation will take place at that level), and the facility data will not be part of the aggregated District values. When aggregating data at Province level the District level raw data will be used since this is the highest available aggregation level selected. Also for Country level aggregates the District raw data will be used. Just to repeat, if we had not specified that District level was an aggregation level, then the facility data and district data would have been added together and caused duplicate (double) population data for districts and all levels above.</para>
        </section>
      </section>
    </section>
    <section>
      <title>Data mart</title>
      <para>The purpose of the data mart is to provide pre-processed data to external data analysis and reporting tools. The data mart consists of two tables, aggregateddatavalues and aggregatedindicatorvalues in the DHIS 2 database. The values in the data mart are aggregated versions of the raw data found in the datavalue table as well as calculated indicator values. Aggregation can take place over time (e.g. from monthly data to aggregated quarterly values), or place (e.g. from PHU data to aggregated district totals) and the data mart can store all kinds of such aggregated values. The data mart is as such just a processed &apos;copy&apos; of the data values and it can be emptied and regenerated at any time, and the tables are read only tables. The metadata in the two data mart tables are referenced by internal identifiers, such as dataelementid, organisationunitid which refer to the tables like dataelement and organisationunit, see &apos;How to make use of the data mart in external tools&apos; for more on this. How the data is aggregated and what ends up in these two tables is controlled from the Data mart export user interface under the Services submenu.</para>
      <section>
        <title>The data mart export process</title>
        <section>
          <title>How to create a data mart export</title>
          <para>In the Data mart management window click on the Add New button and a Generate data mart window will open. There are 4 selection boxes; Data elements, Indicators, Organisation units, and periods. For each of the boxes select what you want to export, note if you don&apos;t want both data elements and indicators, you can leave one of these empty, but at least one of these need some selected items together with selected orgunits and periods. The available list on the left side can be filtered by data element group, indicator group, organisation unit level, and period type accordingly. You can move items across to the selected list by double clicking on an item in the available list or by selecting an item and use the move buttons (see &apos;Selection buttons&apos; explanations below).

</para>
          <para>To export your data mart, you have to save it first. Type a name (preferrably a name that reflects what the data mart covers) in the box at the top of the page, and click the Save button at the bottom. You will be taken back to the &apos;Data mart export management&apos; page. To export your data mart, click on the green button next to your data mart.

</para>
          <para><emphasis role="bold">Selection buttons</emphasis>
</para>
          <itemizedlist>
            <listitem>
              <para>&gt; will move the selected item across form the available list on the left to the selected list on the right
</para>
            </listitem>
            <listitem>
              <para>&gt;&gt; will move all items in the available list across to the selected list
</para>
            </listitem>
            <listitem>
              <para>&gt;&gt;&gt; only applies to orgunits and will move the children of the selected orgunit across to the selected list
</para>
            </listitem>
          </itemizedlist>
        </section>
        <section>
          <title>Orgunit levels</title>
          <para>The data mart can include values aggregated to different levels in the same table and exactly which level a value belongs to is described by the &apos;level&apos; column. When pulling data output of the data mart into external tools it is important to be aware of this level as combining data for different levels will result in duplication. 

For DHIS 1.4 users this means that there is no longer a separate table per level, but instead one common table and a level column that separates the levels. Also note that while in 1.4 you specify in the individual data element and indicator definitions to which orgunit levels the data mart should export to, in DHIS 2 this is only defined in the data mart export window. So in DHIS 2 this is completely decoupled from the data element and indicator definitions and up to any user to define which orgunits (at any level) they want to see aggregated data for.
</para>
        </section>
        <section>
          <title>Period types/ data frequencies</title>
          <para>The data mart can hold values aggregated to different period types or frequencies, e.g. monthly, quarterly or yearly data. The &apos;periodtypeid&apos; refers to the frequency the value belongs to, and the periodids column refers to the exact period, e.g. the periodtype can be &apos;monthly&apos; and the period be &apos;Jan-2010&apos;. Again be careful in combining values with different periodtypes as this will cause duplication.


</para>
          <para>Which orgunits that get exported to data mart (the two tables agggregateddatavalue and aggregatedindicatorvalue) are ONLY controlled through the data mart export window, and there you define this per orgunit, not per orgunit level. There is a filter using orgunit level, but the orgunits that are selected are the only ones that end up in the data mart. Equivalently, only selected data elements and indicators end up in the data mart.

</para>
          <para>Every time you do a data mart you can change which orgunits to export data for. The data values will automatically be aggregated up to the orgunit that is selected, no matter what level.
</para>
        </section>
        <section>
          <title>Data element categories in the data mart</title>
          <para>Each data value for a data element has a reference to a category option combo, which is a combination of the disaggregations for the data value, e.g. (male,&lt;5y) or (In PHU, &lt;1y). These disaggregations are exported as they are to the data mart, and no aggregation is done on this dimension. See the data elements section for more on data element categories and the resource tables section for more information on how to do aggregation on these categories.</para>
        </section>
        <section>
          <title>Limitation to the number of data elements per export</title>
          <para>Due to the limitation in number of columns per table in the database there is a limit to how many data elements that can be selected per data mart export. In postgres this limit is 255 (need to verify this number) data elements. If you need to export more than this number of data elements you have to split it up into multiple data mart exports and run them one by one.</para>
        </section>
        <section>
          <title>Adding new data to an existing data mart</title>
          <para>When you add new data to an existing data mart the new values will be appended to the existing so that the data mart grows for each new process if new selections (such as new periods) have been made. If any of the selected values are already in the data mart, then the old will be replaced by the newly generated values. </para>
        </section>
      </section>
      <section>
        <title>Saved data mart exports</title>
        <para>To simplify the selection process, you can save a data mart export, which basically means saving the selected items (not the data), so that you can run the same at a later point without re-selecting everything. New months need to be added though, while orgunits, data elements and indicators usually stay the same.</para>
        <para>RELATIVE PERIODS IN Data mart -NEW!!</para>
      </section>
      <section>
        <title>Routinely data mart export procedures</title>
        <para>RELATIVE PERIODS IN Data mart -NEW!!</para>
        <para>In a monthly data entry cycle, the typical work routine would be to run all the data mart exports after the data entry process has been finalised. For each of the saved data marts you would typically select the current reporting month and export only for that period to add the newly registered values (and aggregates based on these) to the existing data mart. If any backlog data has been entered or values for previous period have been corrected since the last data mart export then these periods also need to be added.   

E.g. in Sierra Leone they have set up a series of saved data mart exports:
- PHU all indicators
- Chiefdom (subdistrict) all indicators
- District all indicators
- PHU morbidity and mortality raw data
- PHU EPI and nutrition raw data
- PHU HIV data
- PHU RCH data
- Chiefdom Morbidity and Mortality data
- etc.

These exports are then run every month when there is new data. Each saved export is opened one by one, the new period added and the export run. 
</para>
      </section>
    </section>
    <section>
      <title>Resource tables</title>
      <para>Resource tables provide additional information about the dimensions of the data in a format that is well suited for external tools to combine with the data mart tables. By joining the data mart with these resource tables one can easily aggregate along the data element category dimension or data element/indicator/organisation unit groups dimensions. E.g. by tagging all the data values with the category option male or female and provide this in a separate column &apos;gender&apos; one can get subtotals of male and female based on data values that are collected for category option combinations like (male, &lt;5) and (male,&gt;5). See the Pivot Tables section for more examples of how these can be used.

orgunitstructure is another important table in the database that helps to provide the hierarchy of orgunits together with the data. By joining the orgunitstructure table with the data mart tables you can get rows of data values with the full hierarchy, e.g. on the form:
OU1, OU2, OU3, OU4, DataElement, Period, Value
(Sierra Leone, Bo, Badija, Ngelehun CHC, BCG &lt;1, Jan-10, 32)

This format makes it much easier for e.g. pivot tables or other OLAP tools to aggregate data up the hierarchy.
</para>
    </section>
    <section id="reportTable">
      <title>Report tables</title>
      <para>Report tables are meant to be database tables fulfilling the specific data needs of a report, chart, pivot table or other output format. It can be understood as a mini data mart that contains only the data needed for its purpose (the report). The rationale behind this concept is to automatically provide the data sources for reports without bothering the users every time, like a normal data mart, and to speed up the data processing and aggregation (small targeted data marts are obviously faster than big ones).

</para>
      <para>When created and generated a report table will appear in the DHIS 2 database as a normal table, but always with the prefix &apos;_report_&apos;. This table should not be altered manually as it is controlled by the system. These tables are constantly being deleted and recreated as the user wants new updated data within the same table structure. These tables can then be access and used from any third party tool for displaying data. DHIS 2 now suports reports created with Jaspersoft iReport Designer (up to v 2.0.6 DHIS 2 was integrated with the BIRT report designer from the Eclipse platform), and this makes it especially easy to link Jasper reports to report tables and to run these reports from within DHIS 2. However, we see report tables as a much broader tool and concept than to just support Jasper reports. It can and should (for performance gain and automation) be used for as many data output purposes as possible, e.g. as data sources for the database views used for Excel pivot tables.
</para>
      <para>A report table is a data source that can be defined once and then run automatically in the background when a report needs new and updated data. Standard reports are directly linked to a report table, which is then automatically processed in the background when the report is run. Report parameters are added to the report tables to make these generic and reusable over time or across different orgunits. </para>
    </section>
  </section>
  <section>
    <title>How to create report tables</title>
    <para>To create a new report table, go to the Report tables section of the Reports module (Reports -&gt; Report Table). Above the list of standard reports, use the &quot;Add report table&quot; or &quot;Add Dataelement Dimension Table&quot; buttons. A regular report table can be used to hold data on data elements, indicators or dataset completeness, while Dataelement  dimension tables are used to include data element categories in report tables. Creating the tables are done in the same way, however, the only exception being when choosing data.</para>
    <para>To create a report table, you start by making some general choices for the table, the most important of which is the crosstab dimension. Then, you choose what data elements, indicators,  datasets or data element dimensions you want to report on. Finally, you make you options on reporting parameters relating to organisation units and time periods. Each of these steps are described in detail below.</para>
    <section>
      <title>General options</title>
      <screenshot>
        <screeninfo>Report table options</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/general_options.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para><emphasis role="bold">Cross tab dimensions</emphasis></para>
      <para>You can cross-tab one or more of the following dimensions: data element/indicator, orgunit, and period, which means that columns will be created based on the values of the dimensions chosen, e.g. if indicators is selected you will get column names in the table reflecting the names of the selected indicators. You must select at least 1 dimension for the table to be valid. Selecting all 3 is possible, but makes little sense.</para>
      <para>
For example, if you cross-tab on indicators and periods, the column headers will say &quot;&lt;indicator title&gt; &lt;period&gt;&quot;. The organisation units will be listed as rows. See screenshot for clarification:
</para>
      <screenshot>
        <screeninfo>Indicators and periods are cross-tabbed</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/crosstab_ind-per.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>
If you cross-tab on indicators and organisation units, the column headers of the table will say &quot;&lt;indicator title&gt; &lt;organisation unit&gt;&quot;. Now the periods will be listed as rows. See screenshot for clarification:
</para>
      <screenshot>
        <screeninfo>Indicators and organisation units are cross-tabbed</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/crosstab_ind-org.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Note that the options made here regarding crosstab dimentions may have consequences for what options are available when using the report table as a data source later, for example for standard reports.</para>
      <para><emphasis role="bold">Sort order</emphasis></para>
      <para>Affects the rightmost column in the table, allows you to choose to sort it low to high or high to low.</para>
      <para><emphasis role="bold">Top limit</emphasis></para>
      <para>Top limit allow you to set a maximum number of rows you want to include in the report table.</para>
      <para><emphasis role="bold">Include regression</emphasis></para>
      <para>This adds additional columns with regression values that can be included in the report design, e.g. in line charts.</para>
    </section>
    <section>
      <title>Selecting data</title>
      <screenshot>
        <screeninfo>Data options</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/select_data.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para><emphasis role="bold">Indicators/Data elements</emphasis></para>
      <para>Here you select the data elements/indicators that you want to include in the report. Use the group filter to more easily find what you are looking for and double click on the items you want to include, or use the buttons to add/remove elements. You can have both data elements and indicators in the same report.</para>
      <para><emphasis role="bold">Data sets</emphasis></para>
      <para>Here you select the data sets  that you want to include in the report. Including a data set will give you data on the data completeness of the given set, not data on its data elements. Double click on the items you want to include, or use the buttons. </para>
    </section>
    <section>
      <title>Selecting report parameters</title>
      <screenshot>
        <screeninfo>Report parameter options</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/relative_options.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>There are two ways to select both what organisation units to include in a report, and what time periods should be included: relative, or fixed. Fixed organisation units and/or periods means that you select the units/periods to include in the report table when you create the report table. Using relative periods, you can select the time and/or units as parameters when the report table is populated, for example when running a standard report or creating a chart. A combination is also possible, for example to add some organisation units in the report permanently while letting the users choose additional. Report parameters is discussed below. In general, using fixed organisation units and/or time periods are an unnecessary restriction.</para>
      <para><emphasis role="bold">Fixed Organisation Units</emphasis></para>
      <para>To add fixed organisation units, click &quot;Toggle fixed organisation units&quot;. A panel will appear where  you can choose orgunits to always include in the report. If you leave it blank,  the users select orgunits when running the report through the use of  report parameters. Use the drop down menu to filter organisation units by level, double click or use the buttons to add/remove.</para>
      <para><emphasis role="bold">Fixed Periods</emphasis></para>
      <para>To add fixed periods, click &quot;Toggle fixed organisation units&quot;. A panel will appear where  you can choose periods to always include in the report. If you leave it blank,  the users select periods when running the report through the use of  report parameters. Use the drop down menu to choose period type (week, month, etc), the Prev and Next button to choose year,  and double click or use the buttons to add/remove.</para>
      <para><emphasis role="bold">Relative periods</emphasis></para>
      <para>Instead of using fixed/static periods like &apos;Jan-2010&apos; or &apos;Q1-2010&apos;, more generic periods can be used to create reusable report tables, e.g. for monthly reports the period &apos;Reporting month&apos; will simply pick the current reporting month selected by the user when running the report. Note that all relative periods are relative to a &quot;reporting month&quot;. The reporting month is  either selected by the users, otherwise the current month is used. Here is a description of the possible relative periods:

</para>
      <itemizedlist>
        <listitem>
          <para><emphasis role="italic">Reporting month:</emphasis></para>
          <para>Use this for monthly reports. The month selected in the reporting month parameter will be used in the report.
</para>
        </listitem>
        <listitem>
          <para><emphasis role="italic">Months/Quarters this year</emphasis>: </para>
          <para>This will provide one value per month or quarter in the year. This is well suited for standard monthly or quarterly reports where all month/quarters need to be listed. Periods that still have no data will be empty, but will always keep the same column name.
</para>
        </listitem>
        <listitem>
          <para><emphasis role="italic">This year:</emphasis> </para>
          <para>This is the cumulative so far in the year, aggregating the periods from the beginning of the year up to and including the selected reporting month.
</para>
        </listitem>
        <listitem>
          <para><emphasis role="italic">Months/Quarters last year</emphasis>: </para>
          <para>This will provide one value per month or quarter last year, relative to the reporting month. This is well suited for standard monthly or quarterly reports where all month/quarters need to be listed. Periods that still have no data will be empty, but will always keep the same column name.
</para>
        </listitem>
        <listitem>
          <para><emphasis role="italic">Last year:</emphasis> </para>
          <para>This is the cumulative last year, relative to the reporting month, aggregating all the periods from last year.
</para>
        </listitem>
      </itemizedlist>
      <para><emphasis role="bold">Example - relative periods</emphasis></para>
      <para>Let&apos;s say we have chosen three indicators: A, B and C, and we have also chosen to use the relative periods &apos;Reporting month&apos; and &apos;This year&apos; when we created the report table. If the reporting month (selected automatically or by the user) is for example May 2010, the report table will calculate the values for the three selected indicators for May 2010 (= the &apos;Reporting month&apos;) and the accumulated values for the three selected indicators so far in 2010 (= so far &apos;This year&apos;).</para>
      <para>Thus, we will end up with six values for each of the organisation units: &quot;Indicator A May 2010&quot;, &quot;Indicator B May 2010&quot; &quot;Indicator C May 2010&quot;, &quot;Indicator A so far in 2010&quot;, &quot;Indicator B so far in 2010&quot; and &quot;Indicator C so far in 2010&quot;.</para>
      <para><emphasis role="bold">Report parameters</emphasis></para>
      <para>Report parameters make the reports more generic and reusable over time and for different organisation units. These parameters will pop up when generating the report table or running a report based on the report table. The users will select what they want to see in the report. There are four possible report parameters, and you can select none, all, or any combination.</para>
      <itemizedlist>
        <listitem>
          <para><emphasis role="italic">Reporting month:</emphasis> </para>
          <para>This decides which month will be used when the system is choosing the relative periods. If the box it not checked, the user will not be asked for the reporting month when the report is generated - the current month will then be used.
</para>
        </listitem>
        <listitem>
          <para><emphasis role="italic">Grand parent organisation unit:</emphasis> </para>
          <para>Select the grand parent of all the orgunit children and grand children you want listed in the report. E.g. a selected region will trigger the use of the region itself, all its district, and all their sub-districts.
</para>
        </listitem>
        <listitem>
          <para><emphasis role="italic">Parent organisation unit:</emphasis> </para>
          <para>Select the parent of all the orgunit children you want listed in the report. E.g. a selected district will trigger the use of the district itself and all its children/sub-districts.
</para>
        </listitem>
        <listitem>
          <para><emphasis role="italic">Organisation unit:</emphasis> </para>
          <para>This triggers the use of this orgunit in the report. No children are listed.
</para>
        </listitem>
      </itemizedlist>
      <para><emphasis role="bold">Example - report parameters</emphasis></para>
      <para>Continuing with the example on relative periods just above, let&apos;s say that in addition to &apos;Reporting month&apos;, we have chosen  &apos;Parent organisation unit&apos; as a report parameter when we created the report table. When we&apos;re running the report table, we will be asked to select an organisation unit. Now, let&apos;s say we choose &quot;Region R&quot; as the organisation unit. &quot;Region R&quot; has the children &quot;District X&quot; and &quot;District Y&quot;.</para>
      <para>When the report is run, the system will aggregate data for both &quot;District X&quot; and &quot;District Y&quot;. The data will be aggregated from the lowest level where they have been collected. The values for the districts will be aggregated further to give an aggregated value for &quot;Region R&quot;.</para>
      <para>Thus, the report table will generate the six values presented in the previous example, for &quot;District X&quot;, &quot;District Y&quot; and &quot;Region R&quot;.</para>
    </section>
    <section>
      <title>Data element dimension tables</title>
      <para>These tables enable the use of data element categories in report tables. There are two differences from regular report tables. The first is that it is not possible to select crosstab dimensions, as the columns will always be the disaggregations from the category combinations. The other is the actual choice of data. Only one category combination can be added per report, and only data elements from the same category combo can be selected. </para>
      <para>Subtotals and the total will also be included in the table, e.g. a gender (male, female) + EPI age(&lt;1, &gt;1) category combo would give the following columns:
male+&lt;1, male+&gt;1, Female+&lt;1, female+&gt;1, male, female,&lt;1, &gt;1, total.

</para>
      <para><emphasis role="bold">Selecting data</emphasis></para>
      <screenshot>
        <screeninfo>Selecting category combinations</screeninfo>
        <mediaobject>
          <imageobject>
            <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/catcombo.jpg" format="JPEG"/>
          </imageobject>
        </mediaobject>
      </screenshot>
      <para>Use the drop down menu to choose category combinations. The data elements using this category combination will be listed. Double click to add to the report, or use the buttons.
</para>
    </section>
    <section>
      <title>Report table - best practices</title>
      <para>To make the report tables reusable over time and across orgunits they can have \ parameters. Four types of parameters are allowed; orgunit, parent orgunit (for listing of orgunits in one area), grand parent orgunit and reporting month. As a side note it can be mentioned that we are looking into expanding this to include reporting quarter and year, or to make that period parameter more generic with regard to period type somehow. The ability to use period as a parameter makes the report table reusable over time and as such fits nicely with report needs such as monthly, quarterly or annual reports. When a report is run by the user in DHIS 2, the user must specify the values for the report tables that are linked to the report. First the report table is re-generated (deleted and re-created with updated data), and then the report is run (in the background, in Jasper report engine).

</para>
      <para>Report tables can consist of  values related to data elements, indicators or data completeness, which is related to completeness of reporting across orgunits for a given month. Completeness reports will be covered in a separate section.</para>
      <para>There are three dimensions in a report table that identify the data; indicators or data elements, orgunits and periods. For each of these dimensions the user can select which metadata values to include in the report. The user must select one or more data elements or indicators to appear in the report. The orgunit selection can be substituted with a parameter, either one specific orgunit or an orgunit parent (making itself and all its children appear in the report). If one or more orgunits are selected and no orgunit parameter is used, then the report is static with regard to which orgunits to include, which in most cases is an unnecessary restriction to a report.</para>
      <para><emphasis role="bold">Using relative periods</emphasis></para>
      <para>The period selection is more advanced as it can in addition to specific periods like Jan-09, Q1-08, 2007 also contain what is called relative periods. As report usually is run routinely over time a specific period like Jan-09 is not very useful in a report. Instead, if you want to design a monthly report, you should use the relative period called Reporting Month. Then you must also include Reporting Month as one of your report parameters to let the system know what exactly is the Reporting Month on the time of report generation. There are many other relative periods available, and they all relate to the report parameter Reporting Month. E.g. the relative period called So far this year refers to the accumulative value for the year incl. the Reporting Month. If you want a trend report with multiple periods in stead of one aggregated period, you can select e.g. &apos;Months this year&apos;, which would give you values for each month so far in the year. You can do a similar report with quarters. The idea is to support as many generic report types as possible using relative periods, so if you have other report needs, please suggest new relative periods on the mailing list, and they might be added to the report table options.</para>
      <para><emphasis role="bold">Cross-tabbing dimensions</emphasis></para>
      <para>Cross tabbing is a very powerful functionality in report design, as the typical DHIS 2 data table with references to period, data element/indicator and orgunit makes more advanced report design very difficult, as you cannot put e.g. specific indicators, periods or orgunits on specific columns. E.g. by cross-tabbing on the indicator dimension in an indicator report table you will get the indicator names on the column headers in your report, in addition to a column referencing orgunit, and another column referencing period. With such a table design you could drag and drop indicator names to specific columns or chart positions in the iReport software. Similarly you can cross tab on orgunits or periods to make their names specifically available to report design. E.g. by cross-tabbing on periods and selecting the two relative periods &apos;Reporting month&apos; and &apos;This year&apos;, you can design reports with both the last month and the accumulative annual value for given month as they will be available as column headers in your report table. It is also possible to combine two dimensions in cross-tabbing, e.g. period and indicator, which makes it possible to e.g. look at three selected indicators for two specific relative periods. This would e.g. make it possible to make a table or chart based report with BCG, DPT3 and Measles coverage, both for the last month and the accumulative coverage so far in the year. 

</para>
      <para>All in all, by combining the functionality of cross tabbing, relative periods and report table parameters you should have a tool to support most report scenarios. If not, we would be very happy to receive suggestions to further improvements to report tables. As already mentioned, we have started to look at more fine-grained parameters for the period dimension as the &apos;Reporting month&apos; does not cover enough, or at least is not intuitive enough, when it comes to e.g. quarterly reports.
</para>
    </section>
  </section>
  <section>
    <title>Report table outcome</title>
    <para>
When the report table is run, the system will calculate values for specified indicators/data elements/data sets, orgunits and periods. The data will be presented in DHIS 2 in a table layout. The column headers will correspond to the cross-tab dimension you have selected. An example report table showing ANC coverage for a district in The Gambia, is shown below. Here the indicator and the periods are cross-tabbed, as can be seen from the column headers.
</para>
    <screenshot>
      <screeninfo>Example report table</screeninfo>
      <mediaobject>
        <imageobject>
          <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/crosstab_ind-per.jpg" format="JPEG"/>
        </imageobject>
      </mediaobject>
    </screenshot>
    <para>
Above the table there are six buttons; five download buttons and one Back button. Clicking the Back button will simply take you back to the previous screen. The function of the five download buttons, are presented below the screenshot:
</para>
    <screenshot>
      <screeninfo>The download buttons</screeninfo>
      <mediaobject>
        <imageobject>
          <imagedata width="100%" fileref="resources/images/dhis2_creating_reporting/report-table_output.png" format="PNG"/>
        </imageobject>
      </mediaobject>
    </screenshot>
    <para><emphasis role="bold">The five download buttons</emphasis></para>
    <itemizedlist>
      <listitem>
        <para><emphasis role="italic">Download as Excel:</emphasis></para>
        <para>Downloads a generated Excel file you can open in Excel.</para>
        <para/>
      </listitem>
      <listitem>
        <para><emphasis role="italic">Download as CSV:</emphasis></para>
        <para>Downloads a generated .csv file. CSV stands for <emphasis role="bold">C</emphasis>omma <emphasis role="bold">S</emphasis>eparated <emphasis role="bold">V</emphasis>alues. It&apos;s a text file with the file ending .csv. Each  line in the file corresponds to a row in the table, while the columns are separated with semi colons (;). The file can be opened in a text editor as well as in a spread sheet program (such as Excel).</para>
        <para/>
      </listitem>
      <listitem>
        <para><emphasis role="italic">Download as PDF:</emphasis></para>
        <para>Downloads a generated pdf file. The data will be presented in a similar layout as the generated table you are already viewing in DHIS 2.</para>
        <para/>
      </listitem>
      <listitem>
        <para><emphasis role="italic">Download as Report:</emphasis></para>
        <para>Downloads a &quot;styled&quot; pdf file. In addition to present the data in a table layout, this file also presents a chart, showing the aggregated data from all the chosen periods and the parent organisation unit chosen for the report table. The report is generated using the Jasper report engine.</para>
        <para/>
      </listitem>
      <listitem>
        <para><emphasis role="italic">Download as JRXML:</emphasis></para>
        <para>Downloads the design file for the generated Report described in the previous bullet. The design file (with the file ending .jrxml) can be opened in the Jasper iReport Designer software. If you plan to design standard reports, this is the starting point.</para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Standard reports</title>
    <section>
      <title>What is a standard report?</title>
      <para>A standard report is a manually designed report that presents manually chosen data in a manually specified layout. Still, it&apos;s highly flexible, as it can be designed to be reused over and over again, by making use of the powerful report tables.</para>
      <para>A standard report can present any value from any table in the DHIS 2 database, but for the report design, we want the reports to be flexible, so we want to connect the reports to tables that changes through time. The report tables are therefore ideal for the report design.</para>
    </section>
    <section>
      <title>Designing Standard reports in iReport</title>
      <para>Jasper iReport Designer is a tool for creating reports that can be used as Standard Reports in DHIS 2. The tool allows for the creation of standard report templates that can easily be exported from DHIS 2 with up to date data. The process of creating reports involves four major steps:</para>
      <orderedlist>
        <listitem>
          <para>A report table must be created in DHIS 2 with the indicators/data elements/datasets to be used in the report.</para>
        </listitem>
        <listitem>
          <para>You have to run the report table and download the design file (Click the &quot;Download as JRXML&quot; button).</para>
        </listitem>
        <listitem>
          <para>Open the downloaded .jrxml file using the free software Jasper iReport Designer to edit the layout of the report.</para>
        </listitem>
        <listitem>
          <para>The edited report can then be uploaded to DHIS 2 to be used as a standard report.</para>
        </listitem>
      </orderedlist>
      <para>If you want to preview your report during the design in iReport, you actually have to upload your file to DHIS 2 to see how it looks.</para>
      <para>These four steps will be describe in detail in the coming sections. In general, when you are making standard reports you should have a clear idea of how it should look before you even make the report table, as how the report table is designed has implications for how the report can be formatted in iReport. For example, what crosstab dimensions are selected in the report table has consequences for what crosstabs are available for the standard report, and it has consequences for what types of charts you can make.</para>
      <section>
        <title>Download and open the design file</title>
        <para><emphasis>Note: If you have not created a report table yet, you have to do so. See section &quot;How to create report tables&quot; to do so.</emphasis></para>
        <para>Locate your desired report table and run it by clicking the green circle with a white arrow inside. When the report is shown, click the &quot;Download as JRXML&quot; button to download the design file. Then open that file in the Jasper iReport Designer software.</para>
      </section>
      <section>
        <title>Editing the report</title>
        <para>You are now ready to edit the layout of the report. The main iReport window consists of a &quot;Report Inspector&quot; to the left, the report document in the middle, a &quot;Palette&quot; area on the upper right hand side and a &quot;Properties&quot; area on the lower right hand side. The &quot;Report Inspector&quot; are used for selecting and examining the various properties of the report, and when selecting an item in the inspector, the &quot;Properties&quot; panel changes to display properties relating to the selection. The &quot;Palette&quot; is used for adding various elements, e.g. text boxes, images and charts to the document.  
</para>
        <screenshot>
          <screeninfo>Overview of the main iReport window</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="100%" fileref="resources/images/dhis2_creating_reporting/ireport/iReport-window.png" format="PNG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para><emphasis>Note: If you cannot see the Palette or Properties sidebar, you can enable them from the menu item called &quot;Window&quot; on the menu bar.</emphasis></para>
        <para>The iReport document is divided into seven main bands, divided by layout separators (the blue lines). These lines are used to decide how big each of the areas should be on the report. 
</para>
        <para>The areas all have different purposes:
</para>
        <itemizedlist>
          <listitem>
            <para>Title - area for the title of the report</para>
          </listitem>
          <listitem>
            <para>Page header - area for the page header</para>
          </listitem>
          <listitem>
            <para>Column header - area for column headers (for the table)</para>
          </listitem>
          <listitem>
            <para>Detail 1 - area where the actual report data will be placed</para>
          </listitem>
          <listitem>
            <para>Column footer - area to make footer of the table</para>
          </listitem>
          <listitem>
            <para>Page footer - area for the page footer</para>
          </listitem>
          <listitem>
            <para>Summary - elements in this area will be placed at the end of the report</para>
          </listitem>
        </itemizedlist>
        <para>By default you will see that only the Title, Column Header and the Detail 1 bands have data.
        For most reports this is OK. The Title band is suitable for a title and e.g. a chart. 
        Data fields entered into the Detail 1 area will be iterated over to create a table. 
        For example, if a field called &quot;datalementname&quot; is placed in the Detail 1 band,
        all data elements in the report table will be listed here. 
        We&apos;ll come back to data fields management just a little below.</para>
        <para>The unused bands in the report are shrinked to add more space for your report data. You can
        however increase/decrease the band height as you like. There are two ways to do that. The first way is simply to drag the blue band-line as shown below.</para>
        <screenshot>
          <screeninfo>Drag the blue lines to change the band heights</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="66%" fileref="resources/images/dhis2_creating_reporting/ireport/17_drag.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>The other way to adjust the band height is to select a band in the 
        &quot;Report Inspector&quot;, and then adjust the &quot;Band height&quot; value in the 
        &quot;Detail 1 - properties&quot; area in the lower right corner.</para>
        <screenshot>
          <screeninfo>Adjust the size of layout areas by changing the Band height property</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireport/18_adjust.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>As the fields are already present on the report, you probably don&apos;t want to do anything
        than just fix the layout and drag fields around. You can also resize the fields by dragging the side, top or bottom lines. If you want to change the text in the column headers, you simply double click the field and change the text.</para>
        <para>To add the a field to the table, we simply drag it to the Detail 1 band from the &quot;Report Inspector&quot;. The column header will be added automatically.</para>
        <para>By double clicking the box, the text can be edited. The format of the text, such as size, font and alignment, can be adjusted with the tools above the document.</para>
        <screenshot>
          <screeninfo>Double click to edit the text, and change its appearance</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireport/21_title_edit.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para><emphasis role="bold">
            <emphasis role="italic">
              <emphasis role="bold">
                <emphasis role="bold">
                  <emphasis>
                    <emphasis role="bold">NOTE: Fields starting with &quot;$F&quot; present values that are retrieved from the database every time the report is run. The values here will vary, so do not change these fields unless you want a static value here!</emphasis>
                  </emphasis>
                </emphasis>
              </emphasis>
            </emphasis>
          </emphasis></para>
      </section>
<!--       New part on advanced iReporting, replacing Charts section -->      <section>
        <title>Text</title>
        <para>
   There are two types of text in iReport: Text labels and Text fields (data fields). They work in different ways, and should be used for different purposes. The main point is that text fields are just placeholders that will be filled with the correct text from the report table when the report is run, while text labels will stay the way they are when the report is run.</para>
        <section>
          <title>Static text</title>
          <para>Static text are text plain text labels that can be edited normally. There are two ways to edit text labels: </para>
          <itemizedlist>
            <listitem>
              <para>By double clicking in the text box</para>
            </listitem>
            <listitem>
              <para>By using the Static text properties in the Properties panel</para>
            </listitem>
          </itemizedlist>
          <screenshot>
            <screeninfo>Click to edit text label</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="30%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_01.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
        </section>
        <section>
          <title>Text fields</title>
          <para>Text fields are formulas that will be filled from the report table when the report is run. Unlike static text, these can not be edited in a normal way. However, they can be manipulated in various ways to ensure that the desired output will be produced. There are three ways to edit the text fields:</para>
          <para/>
          <itemizedlist>
            <listitem>
              <para>By right clicking on the text box and selecting Edit expression</para>
            </listitem>
            <listitem>
              <para>By double clicking the text field (not recommended, as this will not bring up the expression editor)</para>
            </listitem>
            <listitem>
              <para>By using the Text field properties in the Properties panel</para>
            </listitem>
          </itemizedlist>
          <screenshot>
            <screeninfo>Click to open Expression editor</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="30%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_04.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Click to open Expression editor</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="30%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_06.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>Text fields can represent either numbers or text, so that they can be used both for showing for example names of district or for numeric values. It is therefore important the the Expression class, seen in the Text field properties matches the Text field expression. For the default text fields in the .jrxml file downloaded from DHIS 2 this is not a problem, but it is important when making new text fields. The two most important Expression classes are java.lang.Double for numbers and java.lang.String for text.</para>
          <para/>
          <section>
            <title>Example</title>
            <para>For example, let us say you have a quarterly report where you would like to add a new column with the yearly total. You therefore add a new Static text field to the column header band, and a Text field to the details band in. By default, new Text fields are set to java.lang.String (text). However, the yearly total column will be filled with numbers. We therefore have to change the Expression class for the new text field to java.lang.Double:</para>
            <screenshot>
              <screeninfo>Click to show expression class options</screeninfo>
              <mediaobject>
                <imageobject>
                  <imagedata width="30%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_07.jpg" format="JPEG"/>
                </imageobject>
              </mediaobject>
            </screenshot>
            <screenshot>
              <screeninfo>Choose desired class</screeninfo>
              <mediaobject>
                <imageobject>
                  <imagedata width="30%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_08.jpg" format="JPEG"/>
                </imageobject>
              </mediaobject>
            </screenshot>
            <para>When we edit the text field expression, we see the Expression editor window with all the available columns from the report table. We can see here that each of these are marked with what type they are - text or number. What we need to make sure of is therefore that the expression class we choose for the text field matches the actual expression.</para>
            <screenshot>
              <screeninfo>Expression editor</screeninfo>
              <mediaobject>
                <imageobject>
                  <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_10.jpg" format="JPEG"/>
                </imageobject>
              </mediaobject>
            </screenshot>
          </section>
        </section>
      </section>
      <section>
        <title>Filtering the table rows</title>
        <para>In the default table exported from DHIS 2, there are some rows that it might be better to leave out of the table, and some that it would be preferable to have at the end. For example, when making a table based on a report table with the parent organisation unit parameter, the default table might have a row with the national level somewhere in between all the regions. In iReport, this can be changed so that the parent organisation unit appears at the bottom of the table. This involves two steps that will be explained below. Note that this will not work where there is only one organisation units, and it is therefore most useful when using the parent organisation unit or grand parent organisation unit parameters in the report table.</para>
        <section>
          <title>Hiding the parameter organisation unit from the table</title>
          <para>First, we must make sure that the row with the parent organisation unit (for example the national level) is left out of the regular table. We do this by using a property specific to the Details band called Print when expression. To set a Print when expression, start by selecting the Detail band in the Report inspector, then edit the Print when expression in the properties panel.</para>
          <screenshot>
            <screeninfo>Select Detail 1 in the Report Inspector</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="40%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_11.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Open the Expression Editor by clicking next to Print When Expression</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="40%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_12.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>The Expression editor window should now appear. What we must do is to create an expression that checks if the row being generated is the row with the organisation unit given as a parameter. The report table contains a column that we can use for this called organisation_unit_is_parent. To exclude the row with the parameter organisation unit, double click on organisation_unit_is_parent in the list to copy it to the expression area, then add <command>.equals(&quot;No&quot;)</command> at the end so that the code is:</para>
          <para><command>$F{organisation_unit_is_parent}.equals(&quot;No&quot;)</command></para>
          <para>This tells the report engine to only print table rows where the organisation unit is not the parent organisation unit.</para>
          <screenshot>
            <screeninfo>Code to skip parent organisation unit</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_14.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
        </section>
        <section>
          <title>Hiding other rows</title>
          <para>Using the expression editor it is also possible to exclude other rows from the table, in addition to the parent organisation unit as was explained above. In Ghana, for example, all regions have a fake district which is the name of the region in square brackets. This can also be excluded from the table using the Print when expression that was introduced above. To to this, follow the instructions above to bring up the Expression editor window. Then, we use Java expressions to test whether or not the row should be hidden.</para>
          <section>
            <title>Example - removing rows with organisation units starting with [</title>
            <para>Example - removing rows with organisation units starting with [</para>
            <para><command>($F{organisationunitname}.charAt( 0 ) != &apos;[&apos;)</command></para>
            <para>This makes the report skip any rows where the first character of the organisation unit name is [.</para>
            <para>It is also possible to combine several of these expressions. To do this we put the expressions in a parenthesis with the two characters &amp;&amp; in between. For example, to make a table that leaves both organisation units whose name starts with [ and the parent organisation unit, we can use the following expression:</para>
            <para><command>($F{organisationunitname}.charAt( 0 ) != &apos;[&apos;)&amp;&amp;$F{organisation_unit_is_parent}.equals(&quot;No&quot;)</command></para>
            <screenshot>
              <screeninfo>Combining expressions in the Expression editor</screeninfo>
              <mediaobject>
                <imageobject>
                  <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_29.jpg" format="JPEG"/>
                </imageobject>
              </mediaobject>
            </screenshot>
          </section>
        </section>
        <section>
          <title>Showing the parameter organisation unit at the end of the table</title>
          <para>We have now made sure that the parameter organisation unit is not included in the table as a regular row. However, we often want to include it somewhere in the report. A good way to do this is to add it in the summary band so that it will appear below the table. The easiest way to do this is to copy all the text fields from the Detail band into the summary band, and then just edit the expression for the first column.</para>
          <itemizedlist>
            <listitem>
              <para>Select all the fields in the detail band and choose</para>
            </listitem>
            <listitem>
              <para>Copy from the Edit menu</para>
            </listitem>
            <listitem>
              <para>Click once on the Summary area</para>
            </listitem>
            <listitem>
              <para>Choose Paste from the Edit menu</para>
            </listitem>
            <listitem>
              <para>Position the new fields correctly</para>
            </listitem>
          </itemizedlist>
          <screenshot>
            <screeninfo>Select fields in the details band and copy them</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_16.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Past fields into Summary band</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_25.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Realign fields</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_26.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>The final step is to edit the expression of the first column to make sure that the correct organisation unit is displayed here. Open the Expression editor window and change the expression to $F{param_organisationunit_name}.</para>
          <screenshot>
            <screeninfo>Choose the parameter organisation unit</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_19.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>The report should now have all the regular organisation units as normal rows with their parent or grand parent at the bottom of the table.</para>
        </section>
      </section>
      <section>
        <title>Changing indicator/data element names</title>
        <para>By default, the reports from DHIS 2 uses the short names for indicators and data elements in reports and charts. In some cases these are not always very meaningful for third parties, but with some work they can be given custom names through iReport. This is useful for example if you are making a report with indicators as rows and periods as column, or for charts with indicators. </para>
        <screenshot>
          <screeninfo>Shortnames - before and after</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_000.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>To change the names of an indicator or data element, we have to edit its expression or formula, for example by right clicking the text box and choosing Edit expression to bring up the Expression editor. </para>
        <screenshot>
          <screeninfo>Choose Edit Expression</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_32.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>Next, we have to insert some Java code. In the following example, we will be replacing the shortname of three indicators with their proper names. The code searches for the shortname, and then replaces it with a proper name. </para>
        <screenshot>
          <screeninfo>Expression editor, showing replacing shortnames</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_34.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>
     <command>($F{indicatorname}.equals(&quot;Bed Util All&quot;)) ? &quot;Bed Utilisation - All Wards&quot;</command>
    </para>
        <para>
     <command>:</command>
    </para>
        <para>
     <command>($F{indicatorname}.equals(&quot;Bed Util Mat&quot;)) ? &quot;Bed Utilisation - Maternity&quot;</command>
 </para>
        <para>
  <command>:</command>
 </para>
        <para>
  <command>($F{indicatorname}.equals(&quot;Bed Util Ped&quot;)) ? &quot;Bed Utilisation - Paediatric&quot;</command>
 </para>
        <para>
  <command>:</command>
 </para>
        <para>
  <command>$F{indicatorname}</command>
 </para>
        <para>From this, we can see a pattern that is reusable for more general cases.</para>
        <itemizedlist>
          <listitem>
            <para>For each indicator or data element we want to change the name for, we need one line</para>
          </listitem>
          <listitem>
            <para>Each line is separated by a colon :</para>
          </listitem>
          <listitem>
            <para>We finish the expression with a regular line</para>
          </listitem>
        </itemizedlist>
        <para>Each line has the same format, where the red text is the shortname, the blue text is what we want to insert instead.</para>
        <screenshot>
          <screeninfo>Code for replacing shortnames. Shortname in red, new name in blue</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/ireport_screen_0.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>The same expressions can be used for example when having indicator names along the category axis of a chart.</para>
      </section>
      <section>
        <title>Groups of tables</title>
        <para>There are cases when it can be useful to have several tables in one report. This can be done using Report groups. Using this functionality, one can for example create a report one table for each indicator, or one table of each organisation unit. In the following, we will go through the steps needed to make a report with three indicators, each represented in one table. It is important that the report table does not crosstab on indicators when we want to make groups of tables based on indicators. </para>
        <para>In our example, the .jrxml file downloaded from DHIS 2 will by default have one column for organisation unit and on for indicators (assuming we have chosen periods as the only crosstab dimension). We start by removing the indicator column, since this in not needed in our case, and realign the other fields to fit the report.</para>
        <screenshot>
          <screeninfo>Delete column</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_36.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>Next, we create out Report group. Go to the report insepctor, right click on the report name (dpt is the default) and choose Add Report Group. </para>
        <screenshot>
          <screeninfo>Add Report Group</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="40%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_38.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>A window will appear, with a report group wizard. Select a name for the group, in this case we choose Indicator. In the drop down menu, we can select what columns in the report table we want the groups to be based on. So, if we wanted one table for each organisation unit, we would choose organisation unit name as the report object to group according to. However, since we are grouping by indicators in this example, we choose indicatorname. Then click next. </para>
        <screenshot>
          <screeninfo>Choose grouping parameter - here, indicators</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_39.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>The next step is to select whether or not we want a separate Group header and Group footer band for each report group. In this case, we choose to include both. Click Finish, and the group bands should appear in the report.</para>
        <screenshot>
          <screeninfo>Add group header/footer</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_40.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>If you upload and run the report, it will now create one table for each indicator. However, it will not look very good as there will be no header row over each table - only one header at the top of each page. Also, there is no indication as to which table is showing which indicator. In the following, we will fix this.</para>
        <para>Instead of having the title row in the column header, we can instead move it to the Group header. This will make the heading show up above each individual table. Furthermore, we can add a heading to each table with the name of the indicator. </para>
        <para>Move the column headers from the Column header band to the Indicator group header band.</para>
        <screenshot>
          <screeninfo>Move header row to column header</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_41.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>Next, add a text field to the Indicator group heading band, and edit its expression to display the indicator name.</para>
        <screenshot>
          <screeninfo>Add text field to use as heading</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_42.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <screenshot>
          <screeninfo>Edit text field expression to show indicator name</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_44.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>The report should now have three tables, one for each indicator. Each table will have a heading with the name of the indicator, and also a table header row.</para>
        <screenshot>
          <screeninfo>Example of finished report table</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_45.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <section>
          <title>Sorting and grouping</title>
          <para>When using grouping, some precautions must be taken with regards to sorting. Notably, when adding sorting parameters, whatever parameter is used as basis for the grouping must come first. Thus if you are grouping the report by indicator, and want sort the organisation units alphabetically, you have to choose to sort first by indicator, then by organisation unit name as shown below. For instructions on how to add sorting, see the sorting section above.</para>
          <screenshot>
            <screeninfo>Sorting by indicator and organisation unit name</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_59.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
        </section>
      </section>
      <section>
        <title>Charts</title>
        <para>By default, a 3D bar chart is included in the .jrxml file that is downloaded from DHIS 2. This is set up so that only data from the parameter orgnisation unit (often the parent or grand parent) is used. Usually, this is a good solution. Since it is the default, we will start by looking at bar charts, before looking at line charts.</para>
        <section>
          <title>Bar charts</title>
          <screenshot>
            <screeninfo>Example bar chart</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_54.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>Bar charts are the default chart type in DHIS 2. In this section, we will look at how to make a bar charts like the one above, comparing the value of one inidcator in several districts. To edit the default chart in iReport, right click on it and choose Chart data.</para>
          <screenshot>
            <screeninfo>Choose Edit Chart Data</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_46.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>A window will appear. By default, the Filter expression is filled in so that only data for the parent organisation unit will be displayed. If for some reason you do not want this, simply delete the text in the text box. In this case we do NOT want the filter, as we are making a chart showing a comparison across districts. To continue, click the details tab.</para>
          <screenshot>
            <screeninfo>Select the Details tab</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_47.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>Under details, you see the list of series for the chart. By default, one series is created per crosstab column. In this case, we are looking at data for one indicator for the whole of 2010, for a number of districts. The indicator is along the crosstab dimension.</para>
          <screenshot>
            <screeninfo>List of data series</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_48.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>To make changes to a series, select it and click modify. Another window will appear where there are four areas that can be edit. The three first are required, but it is sufficient to add an empty quote () in one of the first two.</para>
          <screenshot>
            <screeninfo>The data series editor</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_500.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>The first box is a text field where the name of the series can be inserted or edited. This is the field that will be used to fill the text in the legend box (shown below).</para>
          <screenshot>
            <screeninfo>Chart legend</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="15%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_50.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>However, if you want to have the name of each bar along the x-axis of the chart instead of using the legend, this can be done by adding whatever text you want to present in the Category expression field, or by inserting an expression to have it filled automatically when the report is run. In this case, we want to have one bar for each organisation unit. We therefore edit the category expression by clicking on the button to the right.</para>
          <screenshot>
            <screeninfo>Editing the category expression</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_49.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>As the expression, we chose organisationunitname, as shown below.</para>
          <screenshot>
            <screeninfo>Choose organisation unit name.</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_490.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>When we are finished, the series editor should look like below. Click OK, then Close to close the Chart Details window.</para>
          <screenshot>
            <screeninfo>Series editor.</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_501.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>If you add a good description in the Category expression area, you can leave out the legend box. This is done in the Report properties panel of iReport, where you can also edit many other details of the chart.</para>
          <screenshot>
            <screeninfo>Checkbox to show/hide chart legend</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="40%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_51.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>We can also add a title to the chart, for example the name of the indicator. This is also done in the Chart properties panel, under Title expression.</para>
          <screenshot>
            <screeninfo>Edit chart title</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="40%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_55.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>The Expression editor window will appear, where you can enter the title. Note that the title must be in quotes, as shown below.</para>
          <screenshot>
            <screeninfo>Expression editor</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_56.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>The chart is now ready.</para>
        </section>
        <section>
          <title>Line charts</title>
          <para>Line charts can be useful in many circumstances. However, to make line charts the report data (report table) must be suited for it. Thus if you want to make a line chart, it is important that the report table does not have periods in the crosstab dimension. Examples where this is useful is if you are making a report for a single organisation unit with one or more indicators, or if you are making a report with one indicator and one or more organisation units.</para>
          <para>Below, we will go though the steps needed to make a report with a line chart showing the development of three indicators over one year, for one organisation unit. We start by making a report table with the choices shown below:</para>
          <screenshot>
            <screeninfo>Report table - crosstab dimensions</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="30%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_57.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Report table - periods and parameters</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_60.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>When we open the resulting .jrxml-file in iReport, the default line chart is included. Since we want to make a line chart, we delete this chart and drag a new chart element into the report from the Palette panel.</para>
          <screenshot>
            <screeninfo>Delete the default chart</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_61.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Drag in new chart element</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_62.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>As soon as we drag the Chart element into the report, a window will appear. We choose the Line chart, as shown below. </para>
          <screenshot>
            <screeninfo>Choose Line chart</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_63.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>A chart wizard will appear. Click next in the first step, then Finish in the next - we will add the data later.</para>
          <screenshot>
            <screeninfo>Choose Next</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_64.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Choose Finish</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_65.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>Next, adjust the size and position of the chart in your report. Then, we will add one data series for each of our three indicators. Right-click on the chart and choose Chart data. If you are making a chart with one indicator and several organisation units, you probably want to make a filter expression so that only data from the paramter/parent organisation unit is used in the chart. To do this, add this line to the Filter expression area:</para>
          <para><command>$F{organisation_unit_is_parent}.equals(&quot;Yes&quot;)</command></para>
          <para>In our example, we only have on organisation unit, so this is not necessary. Next, click the details tab to see a list of the series in the chart. For now, this list is empty, but we will add one series for each of our three indicators. To add a series, click the Add button.</para>
          <screenshot>
            <screeninfo>Choose the Details tab</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_66.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Choose Add</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_67.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>In the window that appears, enter the name of the first of the indicators in the Series expression window. Remember to put the name in quotes.  In the category expression (along the x-axis) we want the months, so we use the button next to the field to open the Expression editor and add periodname. </para>
          <screenshot>
            <screeninfo>Edit the category expression</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_69.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <screenshot>
            <screeninfo>Choose periodname as the expression</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_68.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>In the value expression, we add the actual data values for our first indicator. Use the Expression editor again to do this. When we are finished, the window should look like the one below, only with different names according to the indicator. </para>
          <screenshot>
            <screeninfo>The finished category series</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="70%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_70.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>You can then Click OK to close the window. Follow the same steps to add a series for the other indicators. </para>
          <screenshot>
            <screeninfo>Chart details after adding three series</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_71.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>Close the window, and the data for the line chart should be ready. However, some additional adjustments might be needed - most of these can be found in the Line chart properties panel. For example, when making a month by month chart as we have in example, there is often not enough space for the month names along the category axis. This can be fixed by rotating the labels by for example -40 degrees, by using the property Category Axis Tick Label Rotation.</para>
          <screenshot>
            <screeninfo>Changing the appearance of the category labels</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="40%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_72.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
          <para>Many other options are available to give the chart the desired look.</para>
          <screenshot>
            <screeninfo>The finished line chart</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="90%" fileref="resources/images/dhis2_creating_reporting/ireportadv/irep_screen_73.jpg" format="JPEG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
        </section>
      </section>
<!--Old part on charts 
<section><title>Charts</title><para>The auto-generated report already has a chart. This can however be edited. To do that, right-click on the chart and select &quot;Chart Data&quot;.</para><screenshot>
          <screeninfo>Select Chart Data by right clicking on the chart</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireport/32_editchart_1.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot><para>Go to the &quot;Details&quot; tab to see what is actually shown in the chart.
</para><screenshot>
          <screeninfo>Go the Details and Add a Category series</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireport/33_editchart_2.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot><para>If you select a series and then click the &quot;Modify&quot; button, a new window will appear. There are four fields that we can fill out, where the three first are mandatory and are already automatically filled.
</para><screenshot>
          <screeninfo>The Category series window</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireport/34_editchart_3.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot><para>You can edit each field by pressing the edit button on the righ.t</para><screenshot>
          <screeninfo>Edit the category expression</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="66%" fileref="resources/images/dhis2_creating_reporting/ireport/35_editchart_4.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot><para>A new window appears with the available fields. A list of available fields to put in the chart will show. If you double-click one of the items, it will be added to the Expression editor.</para><screenshot>
          <screeninfo>Double click on the desired field</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="66%" fileref="resources/images/dhis2_creating_reporting/ireport/36_editchart_5.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot><para>To make the chart more informative and better looking, we can select it by clicking on it and use the &quot;Properties&quot; panel on the right hand side to make adjustments. For example, you can add a title to the chart, change the font, rotate the axis labels (as shown below) and so on.</para><screenshot>
          <screeninfo>Edit the chart properties</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="66%" fileref="resources/images/dhis2_creating_reporting/ireport/39_editchart_9.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        </section>-->      <section>
        <title>Adding the Report to DHIS 2</title>
        <para>We can now switch to DHIS 2 and import our report. Go to the Report Module in DHIS 2, and select &quot;Standard Report&quot;. In the &quot;Standard Report&quot; screen, click &quot;Add new&quot;, or edit an existing one.</para>
        <para>In the following screen, there are several actions we need to take. First, enter a name for the new &quot;Standard Report&quot;. Second, for design, click &quot;Choose File&quot; and find the .jrxml-file you have edited in iReport. Then we select the report table that we used as a basis for the report in iReport. Click add, and it should move to the &quot;Selected report tables&quot; area. Finally, click save. 
</para>
        <screenshot>
          <screeninfo>Upload the file and choose the right report table</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="66%" fileref="resources/images/dhis2_creating_reporting/ireport/27_new_std_report.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
        <para>The report is now available as a &quot;Standard Report&quot; in DHIS 2:</para>
        <screenshot>
          <screeninfo>The report is available as a Standard Report</screeninfo>
          <mediaobject>
            <imageobject>
              <imagedata width="50%" fileref="resources/images/dhis2_creating_reporting/ireport/28_done.jpg" format="JPEG"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </section>
      <section>
        <title>Some final guidelines</title>
        <itemizedlist>
          <listitem>
            <para>Use the same version of iReport and DHIS 2&apos;s version of Jasper reports. See the About page in DHIS 2 for the Jasper version in use.</para>
          </listitem>
          <listitem>
            <para>Use report tables with cross tab dimensions  as your data source for your report designs. This will make it a lot easier to design reports where you need to put specific indicators, periods, or orgunits on columns.</para>
          </listitem>
          <listitem>
            <para>Learn from others, there are many DHIS 2 report designs for Jasper  on  launchpad, see http://bazaar.launchpad.net/~DHIS 2-devs-core/DHIS 2/trunk/files/head:/resources/</para>
          </listitem>
        </itemizedlist>
      </section>
    </section>
  </section>
  <section>
    <title>Charts</title>
    <para>Charts present analysis of data using indicators and subjecting it to comparisons 
across organisation units and over time.</para>
    <section>
      <title>Creating charts</title>
      <para>To create a chart, navigate to Services -&gt; Reports -&gt; Charts. There are three different kinds of charts you can create: Period, organisation or indicator chart. For each chart you can choose whether you want to have bar charts or line charts.</para>
      <itemizedlist>
        <listitem>
          <para><emphasis>Period chart</emphasis></para>
          <para>The period chart lets you choose several indicators, several periods and one organisation unit.</para>
          <para>The chosen periods are listed on the X-axis, and the values for each selected indicator is shown.</para>
          <para>The period chart supports relative periods. That means that if you don&apos;t select any periods when you create the chart, but rather tick the box &quot;Reporting month&quot; under &quot;Relative periods&quot;, the chart will show the results from previous month each time it is run. For example, if you run the chart in June 2011, the chart will present the values for May 2011.</para>
          <screenshot>
            <screeninfo>Example period charts</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="100%" fileref="resources/images/dhis2_creating_reporting/chart_period.png" format="PNG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
        </listitem>
        <listitem>
          <para><emphasis>Organisation unit chart</emphasis></para>
          <para>The organisation unit chart lets you choose several indicators, several organisation units and one period.</para>
          <para>The organisation units are listed on the X-axis, and the values for each indicator is shown.</para>
          <para>The organisation unit chart does <emphasis>not</emphasis> support relative periods.</para>
          <screenshot>
            <screeninfo>Example organisation unit charts</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="100%" fileref="resources/images/dhis2_creating_reporting/chart_orgunit.png" format="PNG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
        </listitem>
        <listitem>
          <para><emphasis>Indicator chart</emphasis></para>
          <para>The indicator chart is similar to the period chart in all but one area:</para>
          <para>The chosen indicators are listed along the X-axis, and the values for each period is shown.</para>
          <screenshot>
            <screeninfo>Example indicator charts</screeninfo>
            <mediaobject>
              <imageobject>
                <imagedata width="100%" fileref="resources/images/dhis2_creating_reporting/chart_indicator.png" format="PNG"/>
              </imageobject>
            </mediaobject>
          </screenshot>
        </listitem>
      </itemizedlist>
      <section>
        <title>Options when creating charts</title>
        <itemizedlist>
          <listitem>
            <para><emphasis>Include regression line</emphasis></para>
            <para>This option adds a line showing the trend of the indicator(s) presented in the chart</para>
          </listitem>
          <listitem>
            <para><emphasis>Include current user organisation unit</emphasis> (from v. 2.2)</para>
            <para>This option includes the organisation unit the current user is assigned to, in addition to other selected organisation units. For example, if the user is assigned to a region, the chart will show values for this region in addition to other selected organisation units.</para>
            <para><emphasis>Note:</emphasis> If this option is chosen when creating a period chart, another organisation unit should not be chosen, as values for only one organisation unit can be presented in a period chart.</para>
          </listitem>
        </itemizedlist>
      </section>
    </section>
  </section>
  <section>
    <title>Setting up and maintaining pivot tables</title>
    <para>Pivot tables provide an excellent and dynamic data analysis tool that can be automatically linked to the DHIS 2 data. Each pivot table has a connection to the database and makes use of the pivot source views (sql queries) in the database to fetch the data. These queries pull all their data from the data mart tables so it is important to keep the data mart updated at all times in order to get the most recent data into the pivot tables. A pivot table can connect to a database on the local computer or on a server. This makes it well suitable for use in a local network where there is only one shared database and multiple clients using pivot tables on their own machines. Excel can also connect to databases running on Linux. The database connection used in the pivot tables is specified in odbc data sources on the computers running pivot tables.</para>
    <para>With the use of the resource tables in the database we can easily get all group sets and categories over to Excel as pivot fields, which is a major improvement to the data analysis process. Here is a short how-to:

</para>
    <para/>
    <para><emphasis role="bold">First time setup</emphasis>
</para>
    <para>1) In DHIS 2, Data Administration, Resource Tables, Tick all and generate
</para>
    <para>2) in DHIS 2, export the data you need to the data mart
</para>
    <para>3) In database (e.g. pgAdmin), insert the pivot views (download at DHIS 2.org)
</para>
    <para>4) Add a Windows data source (administrative tools-&gt;data sources) that links to your database (odbc connection). x64 users on Vista and Win7 need to use the 32bit version to be able to access the postgres odbc driver. This version of the data sources program can be found in the XXX folder.
</para>
    <para>5) In Excel use the Pivot table wizard, connect to your dhis database using the odbc connection and do a select * from one of the pivot views
</para>
    <para>6) define the layout of the table (e.g. pick the dimensions you want to see)

</para>
    <para/>
    <para><emphasis role="bold">On data updates</emphasis>
</para>
    <para>1) Export the new data to data mart
</para>
    <para>2) Refresh the pivot tables
 
</para>
    <para/>
    <para><emphasis role="bold">Changes needed after meta data updates (new indicators, new categories, new groups etc.)</emphasis></para>
    <para>1) Drop/delete all the pivot views in your database
</para>
    <para>2) Re-generate all the resource tables
</para>
    <para>3) Put the views back in
</para>
    <para>4) Refresh your pivot table. If you get errors referring to missing fields then you have to go back to the pivot&apos;s query designer and remove the fields that no longer exists, e.g. if a group set or category has been deleted. To get new categories or group sets in to the table you need to select these in the pivot query designer (data source) as well. Changes to category options or groups and group memberships are pulled in automatically on refresh and require no changes to the pivot query (data source).
</para>
    <section>
      <title>Create a Windows data source (ODBC)</title>
      <para>1) Download (http://www.postgresql.org/ftp/odbc/versions/msi/) and install (straight forward) the postgres odbc driver.

</para>
      <para>2) Open Control Panel --&gt; Administrative tools --&gt; Data Source (ODBC).

</para>
      <para>3) In System DNS tab, add a new data source: 
</para>
      <para>Click &apos;Add&apos; button</para>
      <para>Choose &apos;PostgreSQL Unicode&apos;</para>
      <para>Fill information fixed with your system. e.g.:</para>
      <itemizedlist>
        <listitem>
          <para>Data Source: DHIS 2_sl</para>
        </listitem>
        <listitem>
          <para>Description: DHIS 2 data source in PostgreSQL, used for Excel Pivot Tables</para>
        </listitem>
        <listitem>
          <para>Database: DHIS 2_sl
oSSL mode: prefer</para>
        </listitem>
        <listitem>
          <para>Server: localhost (replace with IP address if connecting over a network)</para>
        </listitem>
        <listitem>
          <para>Port: 5432 (this is the default postgres port, change if the postgres server has another port. Same as in hibernate.properties)</para>
        </listitem>
        <listitem>
          <para>Username: dhis  (the user needed to connect to the database, same as in hibernate properties)</para>
        </listitem>
        <listitem>
          <para>Password: dhis (as above)</para>
        </listitem>
      </itemizedlist>
    </section>
    <section>
      <title>Design the pivot table</title>
      <section>
        <title>Office 2003</title>
        <para>1) Open a new blank spreadsheet
</para>
        <para>2) Go to Data --&gt; PivotTable and PivotChartReport.
</para>
        <para>3) External data source --&gt; next --&gt; Get data --&gt; choose the data source name which we made in previous step.
</para>
        <para>4) The first time you do this the first query window you get is quite poor, so click cancel and wait for Microsoft Query to open.
</para>
        <para>5) In the table selector look for the pivot_source view you need and select that.
</para>
        <para>6) Either select columns one by one or simply select all by double-clicking on the * symbol in the table</para>
        <para>
7) When you have the result set you need (you should be able to see the values in the result set table with your selected fields) you select Return to Excel in the Top menu-&gt;File
</para>
        <para>8) Go next and open the layout window
</para>
        <para>9) Drag and drop the necessary fields for your table. Make sure that routine data tables have the datavalue column in the data area
Notice: Later you can modify the field name by right clicking on it and opening &apos;Field settings&apos;, add a title, some notices and so on for a better pivot table.
</para>
        <para>10) Additional step for indicator tables:
</para>
        <para>Your indicator values should be calculated by Excel using the formula &apos;Factor*Numerator/Denominator&apos; sto make sure Excel aggregates the values (such as percentages) properly. This can be done by inserting a calculated field into the Data field area. In the layout window in the wizard just put any field in data field, e.g. denominatorvalue (the wizard does not accept an empty data field). Then close and when you can see the table in normal view select the denominatorvalue field and in the top menu go to Insert-&gt;Calculated field. In the new window you can give your field the name e.g. IndicatorValue and specify the formula based on the available fields in the list to form the formula &apos;numxfactor/denominatorvalue&apos;. numxfactor is a pre-calculated value of the factor x numeratorvalue.
</para>
      </section>
      <section>
        <title>Office 2007</title>
        <para>1) open a new worksheet
</para>
        <para>2) Go to Data menu, then From Other Sources, From Microsoft Query
</para>
        <para>3) Click yes to confirm opening if you get a security warning popup
</para>
        <para>4) In Choose Data Source: select your odbc connection
</para>
        <para>5) In Query Wizard - Choose Columns, click Cancel, and then Yes to continue editing the query in Microsoft Query
</para>
        <para>6) In Add tables, locate the pivot view you need and select it. Go to Options and filter only Views to make it easier to see the Views. When you can see your table/view in the designer, then close the Add table dialogue.
</para>
        <para>7) Double-click on the * in your table to select all the columns, or pick one by one
</para>
        <para>8) When you can see the data in the designer (it may take some time to load), then go to the top menu File-&gt;Return data to Microsoft Office Excel
</para>
        <para>9) In Excel you&apos;ll see the Import Data dialogue, and there you select to view the data in a Pivot Table Report
</para>
        <para>10) You will then see the Pivot table field list on the right side, and there you can drag and drop fields from the top list to the different areas (filter, column, row, data). You will see that the pivot table is updated automatically.
</para>
        <para>11) Rename the pivot fields by right-clicking on a field and open the Field Settings menu.There you can write in a Custom Name, e.g. &apos;District&apos; in stead of Orgunit2.
</para>
        <para>12) Save your file and the next time you have new data in your data mart you can refresh the pivot table to see all the data in your data mart (filtered by your pivot view), both old and new data.
</para>
        <para>13) If you for some reason need to empty your pivot table, e.g. to send to another computer over email, and you cannot send with data (big size), you can first empty/clean the data mart from the DHIS Data Administration window, and then refresh your pivot table.
</para>
        <para>10) Additional step for indicator tables: See instructions for 2003 above.
</para>
      </section>
    </section>
  </section>
</chapter>
